# Changelog: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º

**–î–∞—Ç–∞:** 05.10.2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üì¶ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è PostgreSQL
- **–§–∞–π–ª:** `db/migrations/20251005_auto_create_loan_payments.sql`
- **–§—É–Ω–∫—Ü–∏—è:** `auto_create_loan_payments()`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –∑–∞ 10 –¥–Ω–µ–π –¥–æ —Å—Ä–æ–∫–∞

**–£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è:**
- –°—Ç–∞—Ç—É—Å –∫—Ä–µ–¥–∏—Ç–∞: `active`
- –ï—Å—Ç—å –¥–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- –î–æ –ø–ª–∞—Ç–µ–∂–∞ –æ—Å—Ç–∞–ª–æ—Å—å ‚â§ 10 –¥–Ω–µ–π
- –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ –µ—â—ë –Ω–µ –ø—Ä–æ—à–ª–∞
- –ü–ª–∞—Ç—ë–∂ –¥–ª—è —ç—Ç–æ–π –¥–∞—Ç—ã –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

#### –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
- **–§–∞–π–ª:** `db/migrations/APPLY_AUTO_PAYMENTS.sql` - –≤—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. API Endpoints

#### `/api/cron/loan-payments`
- **–§–∞–π–ª:** `app/api/cron/loan-payments/route.ts`
- **–ú–µ—Ç–æ–¥—ã:** GET (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è), POST (–∑–∞–ø—É—Å–∫)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π —Ç–æ–ª—å–∫–æ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º

#### `/api/cron/auto-payments`
- **–§–∞–π–ª:** `app/api/cron/auto-payments/route.ts`
- **–ú–µ—Ç–æ–¥—ã:** GET (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è), POST (–∑–∞–ø—É—Å–∫)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º + –∫—Ä–µ–¥–∏—Ç–Ω—ã–º –∫–∞—Ä—Ç–∞–º
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç endpoint –¥–ª—è CRON

### 3. CRON Configuration

#### Vercel Cron
- **–§–∞–π–ª:** `vercel.json`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `0 9 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 UTC / 12:00 –ú–°–ö)
- **Endpoint:** `/api/cron/auto-payments`
- **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:** ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Vercel

### 4. –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

#### UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü—É—Ç—å:** `/admin/auto-payments`
- **–§–∞–π–ª—ã:**
  - `app/(protected)/admin/auto-payments/page.tsx`
  - `app/(protected)/admin/auto-payments/AutoPayments.module.css`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
1. **`–ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢_–ü–õ–ê–¢–ï–ñ–ò.txt`** - –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (3 —à–∞–≥–∞)
2. **`–ó–ê–í–ï–†–®–ï–ù–ò–ï_–ù–ê–°–¢–†–û–ô–ö–ò.md`** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
3. **`SETUP_AUTO_PAYMENTS.md`** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ FAQ
4. **`docs/AUTO_PAYMENTS.md`** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
- **`scripts/apply-loan-payments-migration.mjs`** - Node.js —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
- **`CHANGELOG_AUTO_PAYMENTS.md`** - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º

### –†–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `auto_create_credit_card_payments()`
- –û–±—â–∏–π endpoint `/api/cron/auto-payments` –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `upcoming_payments`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

```typescript
{
  user_id: uuid,
  name: "–ü–ª–∞—Ç—ë–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É: {loan.name}",
  due_date: loan.next_payment_date,
  amount_minor: loan.monthly_payment, // –≤ –∫–æ–ø–µ–π–∫–∞—Ö
  currency: loan.currency,
  account_name: loan.name,
  direction: "expense",
  status: "pending",
  description: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–æ –∑–∞ 10 –¥–Ω–µ–π –¥–æ —Å—Ä–æ–∫–∞ –æ–ø–ª–∞—Ç—ã –∫—Ä–µ–¥–∏—Ç–∞ –≤ –±–∞–Ω–∫–µ {loan.bank}"
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –§–∞–π–ª—ã
- **–°–æ–∑–¥–∞–Ω–æ:** 11 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–ò–∑–º–µ–Ω–µ–Ω–æ:** 1 —Ñ–∞–π–ª (vercel.json - –¥–æ–±–∞–≤–ª–µ–Ω CRON)
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~900 (–≤–∫–ª—é—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é)

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** 1 –º–∏–≥—Ä–∞—Ü–∏—è, 1 —Ñ—É–Ω–∫—Ü–∏—è
- **Backend:** 3 API route
- **Frontend:** 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ + —Å—Ç–∏–ª–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 6 —Ñ–∞–π–ª–æ–≤
- **–£—Ç–∏–ª–∏—Ç—ã:** 1 —Å–∫—Ä–∏–ø—Ç

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase SQL Editor
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# 3. –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
http://localhost:3000/admin/auto-payments

# 4. –ù–∞–∂–∞—Ç—å "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API
```bash
curl -X POST http://localhost:3000/api/cron/auto-payments
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```json
{
  "success": true,
  "totalCreated": 1,
  "details": {
    "creditCards": { "success": true, "count": 0 },
    "loans": { "success": true, "count": 1 }
  },
  "message": "–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ –ø–ª–∞—Ç–µ–∂–µ–π: 1 (–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã: 0, –∫—Ä–µ–¥–∏—Ç—ã: 1)"
}
```

---

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Production

### Vercel

1. **Commit –∏ Push:**
   ```bash
   git add .
   git commit -m "feat: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º"
   git push origin main
   ```

2. **Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –ó–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç CRON –∑–∞–¥–∞—á—É –∏–∑ `vercel.json`
   - –ù–∞—á–Ω—ë—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00 –ú–°–ö

3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å CRON_SECRET**
   - Dashboard ‚Üí Settings ‚Üí Environment Variables
   - `CRON_SECRET=your-secret-token`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Vercel Dashboard:** Functions ‚Üí Logs
- **SQL –ø—Ä–æ–≤–µ—Ä–∫–∞:** 
  ```sql
  SELECT * FROM upcoming_payments 
  WHERE description LIKE '%–∫—Ä–µ–¥–∏—Ç%'
  ORDER BY created_at DESC;
  ```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏: —Ç–æ–ª—å–∫–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π CRON_SECRET –¥–ª—è –∑–∞—â–∏—Ç—ã endpoint
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

---

## üìà –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ –∑–∞—Ä–∞–Ω–µ–µ (–Ω–µ —Ç–æ–ª—å–∫–æ 10 –¥–Ω–µ–π)
- [ ] Email/Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ CRON
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `next_payment_date` –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

---

## üéØ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
2. ‚úÖ **–ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** —Å –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏
3. ‚úÖ **–£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
5. ‚úÖ **Production-ready** —Ä–µ—à–µ–Ω–∏–µ —Å CRON

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:
- –°–æ–∑–¥–∞—ë—Ç –∫—Ä–µ–¥–∏—Ç ‚Üí –£–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—Ç—É –ø–ª–∞—Ç–µ–∂–∞ ‚Üí **–ó–∞–±—ã–≤–∞–µ—Ç –æ–± —ç—Ç–æ–º**
- –ó–∞ 10 –¥–Ω–µ–π –¥–æ —Å—Ä–æ–∫–∞ ‚Üí **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∏–¥–∏—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ** –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–ª–∞—Ç–µ–∂–∏"
- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞—Ç—ë–∂** ‚Üí –≠–∫–æ–Ω–æ–º–∏—Ç –¥–µ–Ω—å–≥–∏ –Ω–∞ —à—Ç—Ä–∞—Ñ–∞—Ö! üí∞

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é ‚Üí –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Üí Deploy
