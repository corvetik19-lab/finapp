# ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `auto_create_loan_payments()` –≤ PostgreSQL
- –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –∑–∞ 10 –¥–Ω–µ–π –¥–æ —Å—Ä–æ–∫–∞

### 2. ‚úÖ API endpoints
- `/api/cron/loan-payments` - —Ç–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç—ã
- `/api/cron/credit-card-payments` - —Ç–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã  
- `/api/cron/auto-payments` - –≤—Å—ë –≤–º–µ—Å—Ç–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 3. ‚úÖ CRON –∑–∞–¥–∞—á–∞
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ `vercel.json`
- –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ **9:00 UTC (12:00 –ú–°–ö)**

### 4. ‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `/admin/auto-payments`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä—É—á–Ω—É—é –∏ —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üöÄ –ö–∞–∫ –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è (3 —à–∞–≥–∞)

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase

**–í–∞—Ä–∏–∞–Ω—Ç –ê (–ë—ã—Å—Ç—Ä—ã–π):**
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí **SQL Editor**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ: `db/migrations/APPLY_AUTO_PAYMENTS.sql`
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä ‚Üí –Ω–∞–∂–º–∏—Ç–µ **RUN** ‚ñ∂Ô∏è

**–í–∞—Ä–∏–∞–Ω—Ç –ë (–ü–æ —Ñ–∞–π–ª–∞–º):**
- –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª: `db/migrations/20251005_auto_create_loan_payments.sql`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:3000/admin/auto-payments

# –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É **–ü–ª–∞—Ç–µ–∂–∏** (`/payments`) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞–ø–∏—Å–∏:
- "–ü–ª–∞—Ç—ë–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É: ..."

---

## üìù –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–º–µ—Ä 1: –£ –≤–∞—Å –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç

```
–ù–∞–∑–≤–∞–Ω–∏–µ: –ò–ø–æ—Ç–µ–∫–∞ –°–±–µ—Ä–±–∞–Ω–∫
–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂: 25 000 —Ä—É–±
–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞: 15.10.2025
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- 05.10.2025 (–∑–∞ 10 –¥–Ω–µ–π) —Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–ª–∞—Ç–µ–∂–∏"
- –í—ã —É–≤–∏–¥–∏—Ç–µ: "–ü–ª–∞—Ç—ë–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É: –ò–ø–æ—Ç–µ–∫–∞ –°–±–µ—Ä–±–∞–Ω–∫" –Ω–∞ —Å—É–º–º—É 25 000 —Ä—É–±
- –°—Ç–∞—Ç—É—Å: "–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã"

### –ü—Ä–∏–º–µ—Ä 2: –£ –≤–∞—Å –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞

```
–ù–∞–∑–≤–∞–Ω–∏–µ: –¢–∏–Ω—å–∫–æ—Ñ—Ñ Black
–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: 15 000 —Ä—É–±
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç—ë–∂: 750 —Ä—É–±
–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞: 20.10.2025
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:**
- 10.10.2025 (–∑–∞ 10 –¥–Ω–µ–π) —Å–æ–∑–¥–∞—Å—Ç—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
- –í—ã —É–≤–∏–¥–∏—Ç–µ: "–ü–ª–∞—Ç—ë–∂ –ø–æ –∫–∞—Ä—Ç–µ: –¢–∏–Ω—å–∫–æ—Ñ—Ñ Black" –Ω–∞ —Å—É–º–º—É 750 —Ä—É–±

---

## ‚öôÔ∏è –í–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –≤ –∫—Ä–µ–¥–∏—Ç–µ

–ü—Ä–∏ **—Å–æ–∑–¥–∞–Ω–∏–∏** –∏–ª–∏ **—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏** –∫—Ä–µ–¥–∏—Ç–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/loans`
2. –ù–∞–∂–º–∏—Ç–µ "–ò–∑–º–µ–Ω–∏—Ç—å" –Ω–∞ –Ω—É–∂–Ω–æ–º –∫—Ä–µ–¥–∏—Ç–µ
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ **"–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞"**
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω—ë—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç –∫—Ä–µ–¥–∏—Ç!

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã –¥–ª—è –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/credit-cards`
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–∞—Ä—Ç—É
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ **"–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞"**

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
http://localhost:3000/admin/auto-payments
```

### –ß–µ—Ä–µ–∑ API
```bash
curl -X POST http://localhost:3000/api/cron/auto-payments
```

### –ß–µ—Ä–µ–∑ SQL (–ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏)
```sql
SELECT * FROM auto_create_loan_payments();
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

### –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ü–ª–∞—Ç–µ–∂–∏" ‚Üí —Ñ–∏–ª—å—Ç—Ä "–û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—ã"

### –í SQL Editor
```sql
-- –í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
SELECT 
  name,
  due_date,
  amount_minor / 100.0 as amount_rubles,
  account_name,
  status,
  created_at
FROM upcoming_payments 
WHERE description LIKE '%–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–æ%'
ORDER BY created_at DESC;

-- –ö–∞–∫–∏–µ –∫—Ä–µ–¥–∏—Ç—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
SELECT 
  name,
  bank,
  monthly_payment / 100.0 as monthly_payment_rubles,
  next_payment_date,
  (next_payment_date - CURRENT_DATE) as days_until_payment
FROM loans 
WHERE status = 'active' 
  AND next_payment_date IS NOT NULL
  AND deleted_at IS NULL;
```

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –î–ª—è —Ä–∞–±–æ—Ç—ã –≤ Production (Vercel)

1. **–î–æ–±–∞–≤–∏—Ç—å CRON —Å–µ–∫—Ä–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - Vercel Dashboard ‚Üí Settings ‚Üí Environment Variables
   - –î–æ–±–∞–≤–∏—Ç—å: `CRON_SECRET` = `–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-—Ç–æ–∫–µ–Ω`

2. **Deploy –Ω–∞ Vercel:**
   ```bash
   git add .
   git commit -m "feat: –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º"
   git push origin main
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å CRON:**
   - Vercel Dashboard ‚Üí Project ‚Üí Logs
   - –î–æ–∂–¥–∞—Ç—å—Å—è 12:00 –ú–°–ö —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
   - –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ dashboard

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `SETUP_AUTO_PAYMENTS.md`
- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/AUTO_PAYMENTS.md`
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** `db/migrations/20251005_auto_create_loan_payments.sql`

---

## üÜò –ü–æ–º–æ—â—å

### –ü–ª–∞—Ç–µ–∂–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (–®–∞–≥ 1)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –∫—Ä–µ–¥–∏—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ "–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ –ø–ª–∞—Ç–µ–∂–∞ ‚â§ 10 –¥–Ω–µ–π
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: `/admin/auto-payments`

### –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network –≤–∫–ª–∞–¥–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö (—Å–º. –≤—ã—à–µ)

---

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤—ã **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞—Ç—ë–∂** –ø–æ –∫—Ä–µ–¥–∏—Ç—É –∏–ª–∏ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç–µ! üéâ

–°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –≤–∞–º –∑–∞ 10 –¥–Ω–µ–π –¥–æ —Å—Ä–æ–∫–∞ –æ–ø–ª–∞—Ç—ã.
