# üîß –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ü—Ä–æ–±–ª–µ–º–∞ —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è, –∑–∞–∫—Ä—ã–≤–∞—è –≤–º–µ—Å—Ç–µ —Å —Å–æ–±–æ–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

## üîç –ü—Ä–∏—á–∏–Ω–∞

**–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```
TransactionsGroupedList (—Ä–æ–¥–∏—Ç–µ–ª—å)
‚îî‚îÄ‚îÄ Modal "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
    ‚îî‚îÄ‚îÄ AttachmentsList
        ‚îî‚îÄ‚îÄ FileViewerModal (–º–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞) ‚ùå
```

–ö–æ–≥–¥–∞ `AttachmentsList` –≤—ã–∑—ã–≤–∞–µ—Ç `setViewingFile()`, —ç—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –º–æ–¥–∞–ª–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –º–æ–¥–∞–ª–∫–∞ –¥—É–º–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è**.

**–î–∞–∂–µ React Portal –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç**, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ DOM-–∏–µ—Ä–∞—Ä—Ö–∏–∏, –∞ –≤ React state –∏–µ—Ä–∞—Ä—Ö–∏–∏.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–¥–Ω—è—Ç—å state –Ω–∞–≤–µ—Ä—Ö (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `viewingFile` state –≤ `TransactionsGroupedList.tsx`:

```tsx
// TransactionsGroupedList.tsx

const [viewingFile, setViewingFile] = useState<{
  fileName: string;
  fileUrl: string;
  mimeType: string | null;
} | null>(null);

// –ü–µ—Ä–µ–¥–∞—Ç—å setter –≤–Ω–∏–∑ —á–µ—Ä–µ–∑ props
<AttachmentsList 
  transactionId={selected.id}
  onViewFile={(file) => setViewingFile(file)}
/>

// –†–µ–Ω–¥–µ—Ä–∏—Ç—å –º–æ–¥–∞–ª–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ù–ê –¢–û–ú –ñ–ï –£–†–û–í–ù–ï —á—Ç–æ –∏ –º–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
{viewingFile && (
  <FileViewerModal
    fileName={viewingFile.fileName}
    fileUrl={viewingFile.fileUrl}
    mimeType={viewingFile.mimeType}
    onClose={() => setViewingFile(null)}
  />
)}

{selected && editMode && (
  <div className={styles.modalOverlay}>
    {/* –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */}
  </div>
)}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ AttachmentsList.tsx:

```tsx
interface AttachmentsListProps {
  transactionId: string;
  onDelete?: (attachmentId: string) => void;
  onViewFile?: (file: {
    fileName: string;
    fileUrl: string;
    mimeType: string | null;
  }) => void;
}

// –í –∫–Ω–æ–ø–∫–µ "–ü—Ä–æ—Å–º–æ—Ç—Ä":
<button
  onClick={(e) => {
    e.stopPropagation();
    if (onViewFile) {
      onViewFile({
        fileName: attachment.storage_path?.split('/').pop() || '–§–∞–π–ª',
        fileUrl: signedUrl,
        mimeType: attachment.mime_type
      });
    }
  }}
>
  –ü—Ä–æ—Å–º–æ—Ç—Ä
</button>

// –£–±—Ä–∞—Ç—å –≤–µ—Å—å internal state viewingFile –∏–∑ AttachmentsList
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π state (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±–æ–ª–µ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **Zustand** - –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π state manager
- **React Context** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ React
- **Event Emitter** - –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –í–∞—Ä–∏–∞–Ω—Ç–∞ 1

1. ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è** - state –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –Ω—É–∂–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
3. ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å** - —Ä–æ–¥–∏—Ç–µ–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–µ–∏–º–∏ –º–æ–¥–∞–ª–∫–∞–º–∏
4. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** - –º–æ–¥–∞–ª–∫–∏ –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å `viewingFile` state –≤ `TransactionsGroupedList.tsx`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `onViewFile` prop –≤ `AttachmentsListProps`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—Å–º–æ—Ç—Ä" —á—Ç–æ–±—ã –≤—ã–∑—ã–≤–∞—Ç—å `onViewFile`
- [ ] –£–±—Ä–∞—Ç—å internal `viewingFile` state –∏–∑ `AttachmentsList`
- [ ] –†–µ–Ω–¥–µ—Ä–∏—Ç—å `<FileViewerModal>` –≤ `TransactionsGroupedList` —Ä—è–¥–æ–º —Å –º–æ–¥–∞–ª–∫–æ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ë–ï–ó —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

**–û—Ç–∫—Ä—ã–≤–∞—Ç—å —Ñ–∞–π–ª –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ:**

```tsx
<button
  onClick={(e) => {
    e.stopPropagation();
    window.open(signedUrl, '_blank');
  }}
>
  –ü—Ä–æ—Å–º–æ—Ç—Ä
</button>
```

–≠—Ç–æ –Ω–µ –º–æ–¥–∞–ª–∫–∞, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

---

## üìö –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. `components/transactions/TransactionsGroupedList.tsx` - –¥–æ–±–∞–≤–∏—Ç—å state
2. `components/transactions/AttachmentsList.tsx` - –∏–∑–º–µ–Ω–∏—Ç—å props –∏ —É–±—Ä–∞—Ç—å internal state
3. `components/transactions/FileViewerModal.tsx` - —É–∂–µ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

**–†–µ–∫–æ–º–µ–Ω–¥—É—é –í–∞—Ä–∏–∞–Ω—Ç 1** - –æ–Ω —á–∏—Å—Ç—ã–π, –ø—Ä–æ—Å—Ç–æ–π –∏ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ–ª–Ω–æ—Å—Ç—å—é.

–î–∞—Ç–∞: 21 –æ–∫—Ç—è–±—Ä—è 2025, 00:05
