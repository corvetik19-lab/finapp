# üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è RAG + KAG Lite

## üìã –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π UI                      ‚îÇ
‚îÇ  ‚Ä¢ –£–º–Ω—ã–π –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π                                   ‚îÇ
‚îÇ  ‚Ä¢ AI —á–∞—Ç-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç                                         ‚îÇ
‚îÇ  ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –∏–Ω—Å–∞–π—Ç—ã                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      RAG Layer                               ‚îÇ
‚îÇ  ‚Ä¢ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (pgvector)                               ‚îÇ
‚îÇ  ‚Ä¢ Embeddings –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (OpenAI)                            ‚îÇ
‚îÇ  ‚Ä¢ –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    KAG Lite Layer                            ‚îÇ
‚îÇ  ‚Ä¢ JSON –≥—Ä–∞—Ñ –æ—Ç–Ω–æ—à–µ–Ω–∏–π                                      ‚îÇ
‚îÇ  ‚Ä¢ –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤                                         ‚îÇ
‚îÇ  ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Supabase + OpenAI                        ‚îÇ
‚îÇ  ‚Ä¢ PostgreSQL + pgvector                                    ‚îÇ
‚îÇ  ‚Ä¢ OpenAI: gpt-4o-mini –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏                        ‚îÇ
‚îÇ  ‚Ä¢ OpenAI: text-embedding-3-small –¥–ª—è embeddings            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î (Embeddings) - –î–µ–Ω—å 1

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [x] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `embedding` –≤ —Ç–∞–±–ª–∏—Ü—É `transactions`
2. [x] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å HNSW –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
3. [x] –°–æ–∑–¥–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
4. [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings (–æ—Ç–ª–æ–∂–µ–Ω–æ - –¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ API)

### üìù –§–∞–π–ª—ã:
- `db/migrations/20250102_add_embeddings.sql`

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```sql
-- 1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É embedding
ALTER TABLE transactions ADD COLUMN embedding vector(1536);

-- 2. –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å
CREATE INDEX ON transactions USING hnsw (embedding vector_cosine_ops);

-- 3. –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
CREATE FUNCTION match_transactions(
  query_embedding vector(1536),
  match_threshold float,
  match_count int
)...
```

---

## üéØ –≠—Ç–∞–ø 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Embeddings - –î–µ–Ω—å 1-2

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [x] –°–æ–∑–¥–∞—Ç—å API endpoint –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings
2. [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
3. [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. [x] –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### üìù –§–∞–π–ª—ã:
- `app/api/embeddings/generate/route.ts` - API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `lib/ai/embeddings.ts` - –£—Ç–∏–ª–∏—Ç—ã embeddings
- `lib/ai/transaction-text.ts` - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embedding –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
async function generateTransactionEmbedding(transaction) {
  const text = transactionToText(transaction);
  const embedding = await openai.embeddings.create({
    model: "text-embedding-3-small",
    input: text
  });
  return embedding.data[0].embedding;
}
```

---

## üéØ –≠—Ç–∞–ø 3: RAG - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ - –î–µ–Ω—å 2-3

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
2. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
3. [ ] –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
4. [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üìù –§–∞–π–ª—ã:
- `app/api/search/transactions/route.ts` - API –ø–æ–∏—Å–∫–∞
- `components/search/SmartSearch.tsx` - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `lib/ai/vector-search.ts` - –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
// –£–º–Ω—ã–π –ø–æ–∏—Å–∫
async function smartSearch(query: string) {
  // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding –∑–∞–ø—Ä–æ—Å–∞
  const queryEmbedding = await generateEmbedding(query);
  
  // 2. –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  const matches = await supabase.rpc('match_transactions', {
    query_embedding: queryEmbedding,
    match_threshold: 0.7,
    match_count: 20
  });
  
  return matches;
}
```

---

## üéØ –≠—Ç–∞–ø 4: RAG - AI –ß–∞—Ç-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç - –î–µ–Ω—å 3-4

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [x] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞ (–£–ñ–ï –ï–°–¢–¨: `/ai-chat`)
2. [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RAG pipeline –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç
3. [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –æ—Ç–≤–µ—Ç—ã
4. [x] –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (–£–ñ–ï –ï–°–¢–¨)
5. [ ] –î–æ–±–∞–≤–∏—Ç—å —É–º–Ω—ã–π –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —á–∞—Ç

### üìù –§–∞–π–ª—ã:
- `app/(protected)/ai-chat/Chat.tsx` - –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô UI —á–∞—Ç–∞
- `app/(protected)/ai-chat/actions.ts` - –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –¥–µ–π—Å—Ç–≤–∏—è
- `lib/ai/rag-pipeline.ts` - RAG –ª–æ–≥–∏–∫–∞ (–°–û–ó–î–ê–¢–¨)
- `lib/ai/chat-context.ts` - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —á–∞—Ç–∞ (–°–û–ó–î–ê–¢–¨)

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
// RAG Pipeline
async function answerQuestion(question: string, userId: string) {
  // 1. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  const context = await searchRelevantTransactions(question, userId);
  
  // 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  const accounts = await getAccounts(userId);
  const budgets = await getBudgets(userId);
  
  // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
  const prompt = buildPrompt(question, context, accounts, budgets);
  
  // 4. –ó–∞–ø—Ä–æ—Å –∫ LLM
  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [
      { role: "system", content: FINANCIAL_ASSISTANT_PROMPT },
      { role: "user", content: prompt }
    ]
  });
  
  return response.choices[0].message.content;
}
```

---

## üéØ –≠—Ç–∞–ø 5: KAG Lite - –ì—Ä–∞—Ñ –æ—Ç–Ω–æ—à–µ–Ω–∏–π - –î–µ–Ω—å 4-5

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
2. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
3. [ ] –°–æ–∑–¥–∞—Ç—å API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≥—Ä–∞—Ñ–∞
4. [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### üìù –§–∞–π–ª—ã:
- `db/migrations/20250103_knowledge_graph.sql`
- `app/api/ai/graph/build/route.ts` - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
- `lib/ai/knowledge-graph.ts` - –†–∞–±–æ—Ç–∞ —Å –≥—Ä–∞—Ñ–æ–º
- `lib/ai/pattern-detection.ts` - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –≥—Ä–∞—Ñ–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
CREATE TABLE knowledge_graph (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES auth.users NOT NULL,
  entity_type text NOT NULL, -- 'transaction', 'category', 'account', 'merchant'
  entity_id uuid NOT NULL,
  related_type text NOT NULL,
  related_id uuid NOT NULL,
  relation_type text NOT NULL, -- 'belongs_to', 'follows', 'similar_to'
  strength float NOT NULL, -- 0.0 - 1.0
  metadata jsonb,
  created_at timestamptz DEFAULT now()
);
```

```typescript
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
async function buildKnowledgeGraph(userId: string) {
  const transactions = await getTransactions(userId);
  
  for (const txn of transactions) {
    // 1. –°–≤—è–∑—å: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏—è
    await addRelation({
      entity: { type: 'transaction', id: txn.id },
      related: { type: 'category', id: txn.category_id },
      relation: 'belongs_to',
      strength: 1.0
    });
    
    // 2. –°–≤—è–∑—å: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Üí —Å—á–µ—Ç
    await addRelation({
      entity: { type: 'transaction', id: txn.id },
      related: { type: 'account', id: txn.account_id },
      relation: 'from_account',
      strength: 1.0
    });
    
    // 3. –°–≤—è–∑—å: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    const prevTxn = findPreviousTransaction(txn);
    if (prevTxn) {
      await addRelation({
        entity: { type: 'transaction', id: prevTxn.id },
        related: { type: 'transaction', id: txn.id },
        relation: 'followed_by',
        strength: 0.8
      });
    }
  }
}
```

---

## üéØ –≠—Ç–∞–ø 6: KAG Lite - –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ - –î–µ–Ω—å 5-6

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
2. [ ] –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫
3. [ ] –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ç –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏/–≤—Ä–µ–º–µ–Ω–∏
4. [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### üìù –§–∞–π–ª—ã:
- `lib/ai/patterns/temporal.ts` - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- `lib/ai/patterns/sequential.ts` - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- `lib/ai/patterns/clustering.ts` - –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
// –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
async function detectPatterns(userId: string) {
  const graph = await getKnowledgeGraph(userId);
  
  // 1. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  const temporalPatterns = analyzeTemporalPatterns(graph);
  // –†–µ–∑—É–ª—å—Ç–∞—Ç: "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã ‚Üí –ü—è—Ç–Ω–∏—Ü–∞ –≤–µ—á–µ—Ä (85%)"
  
  // 2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  const sequentialPatterns = analyzeSequentialPatterns(graph);
  // –†–µ–∑—É–ª—å—Ç–∞—Ç: "–†–µ—Å—Ç–æ—Ä–∞–Ω ‚Üí –¢–∞–∫—Å–∏ (82% —Å–ª—É—á–∞–µ–≤)"
  
  // 3. –ö–ª–∞—Å—Ç–µ—Ä—ã —Ç—Ä–∞—Ç
  const spendingClusters = clusterTransactions(graph);
  // –†–µ–∑—É–ª—å—Ç–∞—Ç: "–í—ã—Ö–æ–¥–Ω—ã–µ: 3000‚ÇΩ —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤"
  
  return {
    temporal: temporalPatterns,
    sequential: sequentialPatterns,
    clusters: spendingClusters
  };
}
```

---

## üéØ –≠—Ç–∞–ø 7: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ - –î–µ–Ω—å 6-7

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [ ] –°–æ–∑–¥–∞—Ç—å –¥–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
2. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
3. [x] UI –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (–£–ñ–ï –ï–°–¢–¨: `/ai-advisor`)
4. [x] UI –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–£–ñ–ï –ï–°–¢–¨: `/ai-analytics`)
5. [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RAG+KAG –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### üìù –§–∞–π–ª—ã:
- `app/api/ai/recommendations/route.ts` - API —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (–°–û–ó–î–ê–¢–¨)
- `app/(protected)/ai-advisor/AIAdvisorClient.tsx` - –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô UI
- `app/(protected)/ai-analytics/` - –°–£–©–ï–°–¢–í–£–Æ–©–ê–Ø —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `lib/ai/recommender.ts` - –î–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (–°–û–ó–î–ê–¢–¨)

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
// –¢–∏–ø—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
enum RecommendationType {
  BUDGET_WARNING = 'budget_warning',
  SAVINGS_OPPORTUNITY = 'savings_opportunity',
  SPENDING_PATTERN = 'spending_pattern',
  OPTIMIZATION = 'optimization'
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
async function generateRecommendations(userId: string) {
  const patterns = await detectPatterns(userId);
  const budgets = await getBudgets(userId);
  const recommendations = [];
  
  // 1. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±—é–¥–∂–µ—Ç–µ
  for (const budget of budgets) {
    if (budget.used / budget.limit > 0.9) {
      recommendations.push({
        type: RecommendationType.BUDGET_WARNING,
        title: `–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ "${budget.category}"`,
        description: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${budget.used}‚ÇΩ –∏–∑ ${budget.limit}‚ÇΩ`,
        action: "–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç—Ä–∞—Ç—ã –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é"
      });
    }
  }
  
  // 2. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —ç–∫–æ–Ω–æ–º–∏–∏
  if (patterns.sequential['restaurant_taxi'] > 0.8) {
    recommendations.push({
      type: RecommendationType.SAVINGS_OPPORTUNITY,
      title: "–≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ —Ç–∞–∫—Å–∏",
      description: "–í—ã —á–∞—Å—Ç–æ –±–µ—Ä–µ—Ç–µ —Ç–∞–∫—Å–∏ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞",
      action: "–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ø–Ω–¥–µ–∫—Å.–ü–ª—é—Å (—ç–∫–æ–Ω–æ–º–∏—è 30%)"
    });
  }
  
  return recommendations;
}
```

---

## üéØ –≠—Ç–∞–ø 8: UI/UX –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –î–µ–Ω—å 7-8

### ‚úÖ –ó–∞–¥–∞—á–∏:
1. [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É AI –ø–æ–º–æ—â–Ω–∏–∫–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
2. [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É AI Dashboard
3. [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–∂–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –≥–ª–∞–≤–Ω—É—é
4. [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
5. [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è AI —Ñ—É–Ω–∫—Ü–∏–π

### üìù –§–∞–π–ª—ã:
- `app/(protected)/ai/page.tsx` - AI Dashboard
- `components/ai/AIDashboard.tsx` - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `components/ai/PatternInsights.tsx` - –ò–Ω—Å–∞–π—Ç—ã –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- `components/ai/AIOnboarding.tsx` - –û–Ω–±–æ—Ä–¥–∏–Ω–≥

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### KPI:
- [ ] **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞**: >85% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] **–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤**: >4/5 –æ—Ü–µ–Ω–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] **–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**: >70% –ø—Ä–∏–º–µ–Ω—è—é—Ç
- [ ] **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: <2s –Ω–∞ –∑–∞–ø—Ä–æ—Å
- [ ] **–°—Ç–æ–∏–º–æ—Å—Ç—å**: <$30/–º–µ—Å—è—Ü –Ω–∞ OpenAI API

---

## üí∞ –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### OpenAI API (–Ω–∞ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):
- **Embeddings**: ~10,000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π/–¥–µ–Ω—å √ó $0.00002 = $0.20/–¥–µ–Ω—å
- **Chat completions**: ~500 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å √ó $0.0001 = $0.05/–¥–µ–Ω—å
- **–ò—Ç–æ–≥–æ**: ~$7.50/–º–µ—Å—è—Ü

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- **Supabase**: –≤–∫–ª—é—á–µ–Ω–æ –≤ –ø–ª–∞–Ω
- **pgvector**: –±–µ—Å–ø–ª–∞—Ç–Ω–æ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Postgres)

### –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $10-15/–º–µ—Å—è—Ü

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–µ–Ω—å 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç
1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (embeddings)
2. –ë–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
3. –§—É–Ω–∫—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

### –î–µ–Ω—å 2-3: RAG Core
1. API –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
2. UI —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
3. RAG pipeline

### –î–µ–Ω—å 3-4: AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞
2. API —á–∞—Ç–∞ —Å RAG
3. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

### –î–µ–Ω—å 4-5: KAG Lite
1. –¢–∞–±–ª–∏—Ü–∞ –≥—Ä–∞—Ñ–∞
2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
3. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### –î–µ–Ω—å 6-7: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. –î–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
2. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –¥–∞—à–±–æ—Ä–¥

### –î–µ–Ω—å 8: –ü–æ–ª–∏—Ä–æ–≤–∫–∞
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å API
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –±–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

### –†–∏—Å–∫ 2: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –æ—á–µ—Ä–µ–¥—å

### –†–∏—Å–∫ 3: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

---

## üìö –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. [ ] –î–æ–±–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –¥–ª—è —á–∞—Ç–∞
2. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –∏–Ω—Å–∞–π—Ç–æ–≤ –≤ PDF
3. [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ç
4. [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (–±–∞–Ω–∫–∏)
5. [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å AI

---

## üéâ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–ù–∞—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: 02.11.2025, 23:30

### –í –ø—Ä–æ—Ü–µ—Å—Å–µ:
- [ ] –≠—Ç–∞–ø 6: –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞)
- [ ] –≠—Ç–∞–ø 7: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
- [x] –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [x] **–≠—Ç–∞–ø 1**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î (–º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ Supabase MCP)
  - [x] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –≤–∫–ª—é—á–µ–Ω–æ
  - [x] –ö–æ–ª–æ–Ω–∫–∞ embedding –¥–æ–±–∞–≤–ª–µ–Ω–∞
  - [x] –ò–Ω–¥–µ–∫—Å—ã HNSW —Å–æ–∑–¥–∞–Ω—ã
  - [x] –§—É–Ω–∫—Ü–∏–∏ match_transactions() –∏ get_embedding_stats()
- [x] **–≠—Ç–∞–ø 2**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Embeddings (75%)
  - [x] API `/api/ai/embeddings/generate` (POST/GET)
  - [x] –£—Ç–∏–ª–∏—Ç—ã buildTransactionText() –∏ createEmbedding()
  - [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenRouter –≤–º–µ—Å—Ç–æ OpenAI
- [x] **–≠—Ç–∞–ø 3**: RAG –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (100%)
  - [x] API `/api/ai/search/transactions` –¥–ª—è —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
  - [x] –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Å—á–µ—Ç–∞–º–∏
- [x] **–≠—Ç–∞–ø 4**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RAG –≤ AI —á–∞—Ç (100%)
  - [x] RAG Pipeline —Å–æ–∑–¥–∞–Ω (`lib/ai/rag-pipeline.ts`)
  - [x] Tool `searchTransactions` –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç
  - [x] –§—É–Ω–∫—Ü–∏–∏: `searchRelevantTransactions()`, `getFinancialContext()`, `buildSystemPromptWithContext()`
  - [x] –ß–∞—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –∏—Å–∫–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Å–º—ã—Å–ª—É –∑–∞–ø—Ä–æ—Å–∞!
- [x] **–≠—Ç–∞–ø 5**: KAG Lite - –ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π (100%)
  - [x] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –¥–ª—è knowledge_graph (—Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
  - [x] –§—É–Ω–∫—Ü–∏–∏: `get_related_entities()`, `find_transaction_patterns()`
  - [x] –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings (`scripts/generate-embeddings.ts`)
  - [x] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ AI —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞):
- ‚úÖ `/ai-chat` - AI —á–∞—Ç-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (OpenRouter)
- ‚úÖ `/ai-advisor` - AI —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫
- ‚úÖ `/ai-analytics` - AI –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. ‚úÖ ~~–°–æ–∑–¥–∞—Ç—å RAG pipeline –¥–ª—è —á–∞—Ç–∞~~ - –ì–û–¢–û–í–û
2. ‚úÖ ~~–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ AI —á–∞—Ç~~ - –ì–û–¢–û–í–û
3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
4. –°–æ–∑–¥–∞—Ç—å –¥–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è AI Advisor (KAG)
5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ AI Analytics (KAG)
6. –°–æ–∑–¥–∞—Ç—å –≥—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π –¥–ª—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 02.11.2025, 23:58

## üéä –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–° RAG + KAG LITE

### ‚úÖ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:

**RAG (Retrieval-Augmented Generation):**
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î —Å pgvector
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings —á–µ—Ä–µ–∑ OpenRouter
- ‚úÖ –£–º–Ω—ã–π –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Å–º—ã—Å–ª—É
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AI —á–∞—Ç
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö

**KAG Lite (Knowledge-Augmented Generation):**
- ‚úÖ –ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π (knowledge_graph —Ç–∞–±–ª–∏—Ü–∞)
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ —Å–≤—è–∑–µ–π
- ‚úÖ –ü–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings

**AI –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ `/ai-chat` - —á–∞—Ç —Å RAG –ø–æ–∏—Å–∫–æ–º
- ‚úÖ `/ai-advisor` - –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º
- ‚úÖ `/ai-analytics` - –≥–æ—Ç–æ–≤ –∫ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

### üöÄ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤ AI —á–∞—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å:
- "–ü–æ–∫–∞–∂–∏ –≤—Å–µ –∫–∞—Ñ–µ –∑–∞ –æ–∫—Ç—è–±—Ä—å" ‚Üí RAG –Ω–∞–π–¥–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- "–°–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –Ω–∞ —Ç–∞–∫—Å–∏?" ‚Üí –£–º–Ω—ã–π –ø–æ–∏—Å–∫ + –∞–Ω–∞–ª–∏–∑
- "–ì–¥–µ —è –µ–ª –≤ –ø—Ä–æ—à–ª–æ–º –º–µ—Å—è—Ü–µ?" ‚Üí –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –º–µ—Å—Ç

---

## ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ù–ê OPENAI API (–ó–∞–≤–µ—Ä—à–µ–Ω–æ 03.11.2025)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Å OpenRouter –Ω–∞ OpenAI API**
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ AI —Ñ—É–Ω–∫—Ü–∏–∏
   - Embeddings: `text-embedding-3-small`
   - Chat: `gpt-4o-mini` (–±—ã—Å—Ç—Ä–∞—è –∏ –¥–µ—à—ë–≤–∞—è)
   - Analytics: `gpt-4o` (–º–æ—â–Ω–∞—è)

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞**
   - –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–π
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ dotenv

3. **–£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings**
   - ‚úÖ 100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫
   - ‚úÖ 102 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å embeddings (37.78% –ø–æ–∫—Ä—ã—Ç–∏–µ)
   - –°–∫—Ä–∏–ø—Ç: `npx tsx scripts/generate-embeddings.ts`

4. **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
   - `lib/ai/embeddings.ts` - OpenAI embeddings
   - `lib/ai/openrouter.ts` ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç OpenAI
   - `app/api/ai/chat/route.ts` - OpenAI chat API
   - `.env.local` - OpenAI API –∫–ª—é—á
   - `scripts/generate-embeddings.ts` - –æ—Ç–ª–∞–¥–∫–∞ –∏ dotenv

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
OPENAI_API_KEY=sk-proj-xxx...xxx
```

### API Endpoints —Ä–∞–±–æ—Ç–∞—é—Ç:

- ‚úÖ `/api/ai/chat` - AI —á–∞—Ç —Å OpenAI
- ‚úÖ `/api/ai/embeddings/generate` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
- ‚úÖ `/api/ai/search/transactions` - –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- ‚úÖ `/api/ai/graph/build` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
- ‚úÖ `/api/ai/recommendations` - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ `/api/ai/patterns` - –∞–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 03.11.2025, 08:00 UTC+3
