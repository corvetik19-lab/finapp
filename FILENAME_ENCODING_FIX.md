# ‚úÖ FILENAME ENCODING FIX

## üîß –ü—Ä–æ–±–ª–µ–º–∞

```
StorageApiError: Invalid key: 
94bb6cd5-3b0b-48a2-b904-b070ba28a38b/1760990186196-–ø–ø.docx
```

**–ü—Ä–∏—á–∏–Ω–∞:** Supabase Storage –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ –ø—É—Ç—è—Ö –∫ —Ñ–∞–π–ª–∞–º.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤: —Ç–æ–ª—å–∫–æ timestamp + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

### –î–æ:
```tsx
const fileName = `${user.id}/${timestamp}-${file.name}`;
// –†–µ–∑—É–ª—å—Ç–∞—Ç: user-id/1760990186196-–ø–ø.docx ‚ùå
```

### –ü–æ—Å–ª–µ:
```tsx
const timestamp = Date.now();
const fileExtension = file.name.split('.').pop() || 'file';
const safeFileName = `${user.id}/${timestamp}.${fileExtension}`;
// –†–µ–∑—É–ª—å—Ç–∞—Ç: user-id/1760990186196.docx ‚úÖ
```

---

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### FileUpload.tsx:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–º–µ–Ω–∏:**
   - –£–±—Ä–∞–Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –∏–∑ –ø—É—Ç–∏
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `timestamp.extension`
   - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –ë–î –ø–æ–∑–∂–µ)

2. **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:**
   ```
   {user_id}/{timestamp}.{ext}
   
   –ü—Ä–∏–º–µ—Ä—ã:
   ‚úÖ 94bb6cd5.../1729458123456.docx
   ‚úÖ 94bb6cd5.../1729458234567.pdf
   ‚úÖ 94bb6cd5.../1729458345678.jpg
   ```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏** (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)  
‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞** (timestamp)  
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ** (.docx, .pdf, .jpg)  
‚úÖ **–ö–æ—Ä–æ—Ç–∫–∏–µ –ø—É—Ç–∏** (–±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞)  

---

## üîÑ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –º–æ–∂–Ω–æ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É –≤ –ë–î
```sql
ALTER TABLE attachments 
ADD COLUMN original_name TEXT;
```

–ó–∞—Ç–µ–º –≤ FileUpload.tsx:
```tsx
.insert({
  transaction_id: transactionId,
  user_id: user.id,
  storage_path: data.path,
  size_bytes: file.size,
  mime_type: file.type,
  original_name: file.name  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
});
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏–∑ metadata
```tsx
// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
.upload(safeFileName, file, {
  cacheControl: '3600',
  upsert: false,
  metadata: {
    originalName: file.name
  }
});
```

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã —Å –ª—é–±—ã–º–∏ –∏–º–µ–Ω–∞–º–∏:

‚úÖ `–¥–æ–∫—É–º–µ–Ω—Ç.docx`  
‚úÖ `–æ—Ç—á—ë—Ç 2024.pdf`  
‚úÖ `—Ñ–æ—Ç–æ ‚Ññ123.jpg`  
‚úÖ `—Ñ–∞–π–ª (–∫–æ–ø–∏—è).xlsx`  

–í—Å–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:
- `1729458123456.docx`
- `1729458234567.pdf`
- `1729458345678.jpg`
- `1729458456789.xlsx`

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

**–§–∞–π–ª—ã —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.**

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å —Ä—É—Å—Å–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º!

---

**–î–∞—Ç–∞:** 20 –æ–∫—Ç—è–±—Ä—è 2025, 22:58  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Encoding fixed
