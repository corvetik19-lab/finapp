# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–Ω–¥–µ—Ä–æ–≤

**–î–∞—Ç–∞:** 14.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º—ã

1. ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —ç—Ç–∞–ø–∞: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —ç—Ç–∞–ø–∞"
2. ‚ùå –í—Å–µ —ç—Ç–∞–ø—ã –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ "‚úó –ù–µ–∞–∫—Ç–∏–≤–µ–Ω", —Ö–æ—Ç—è –±—ã–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã

## –ü—Ä–∏—á–∏–Ω—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è `is_active`
- –í —Ç–∞–±–ª–∏—Ü–µ `tender_stages` –Ω–µ –±—ã–ª–æ –∫–æ–ª–æ–Ω–∫–∏ `is_active`
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—ã—Ç–∞–ª—Å—è –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ

### 2. API –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª –≤—Å–µ –ø–æ–ª—è
- `PATCH /api/tenders/stages/[id]` –æ–±–Ω–æ–≤–ª—è–ª —Ç–æ–ª—å–∫–æ `name`, `color`, `is_final`
- –ù–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å: `category`, `order_index`, `is_active`

### 3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –í –ë–î: `category` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ `text` (`"tender_dept"`, `"realization"`)
- –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ: –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –∫–∞–∫ `number` (`category === 1`)

## –†–µ—à–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_active`

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0104_add_is_active_to_tender_stages.sql`

```sql
ALTER TABLE tender_stages 
ADD COLUMN IF NOT EXISTS is_active boolean DEFAULT true NOT NULL;

UPDATE tender_stages SET is_active = true WHERE is_active IS NULL;

CREATE INDEX IF NOT EXISTS idx_tender_stages_active 
ON tender_stages(is_active) WHERE is_active = true;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç—Ç–∞–ø—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ü–æ–ª–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`

### 2. –û–±–Ω–æ–≤–ª—ë–Ω API

**–§–∞–π–ª:** `app/api/tenders/stages/[id]/route.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë—ã–ª–æ
const { name, color, is_final } = body;

// –°—Ç–∞–ª–æ
const { name, color, is_final, category, order_index, is_active } = body;

// –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π
if (category !== undefined) updateData.category = category;
if (order_index !== undefined) updateData.order_index = order_index;
if (is_active !== undefined) updateData.is_active = is_active;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ API —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –ø–æ–ª—è —ç—Ç–∞–ø–∞
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–§–∞–π–ª:** `components/tenders/settings/stage-modal.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë—ã–ª–æ
category: 1,  // number
<option value={1}>–ü—Ä–µ–¥–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>

// –°—Ç–∞–ª–æ
category: 'tender_dept',  // string
<option value="tender_dept">–ü—Ä–µ–¥–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>
<option value="realization">–†–µ–∞–ª–∏–∑–∞—Ü–∏—è</option>
```

**–§–∞–π–ª:** `app/(protected)/tenders/settings/tender-settings-complete.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë—ã–ª–æ
{stage.category === 1 ? '–ü—Ä–µ–¥–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è' : '–†–µ–∞–ª–∏–∑–∞—Ü–∏—è'}

// –°—Ç–∞–ª–æ
{stage.category === 'tender_dept' || stage.category === 1 ? '–ü—Ä–µ–¥–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è' : '–†–µ–∞–ª–∏–∑–∞—Ü–∏—è'}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–æ–≤
```sql
SELECT id, name, is_active, category, order_index 
FROM tender_stages 
ORDER BY order_index;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ —ç—Ç–∞–ø—ã –∏–º–µ—é—Ç `is_active: true`
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: `"tender_dept"` –∏–ª–∏ `"realization"`

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞
1. –û—Ç–∫—Ä—ã—Ç—å `/tenders/settings`
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–≠—Ç–∞–ø—ã"
3. –ù–∞–∂–∞—Ç—å ‚úèÔ∏è –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ
4. –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
5. –ù–∞–∂–∞—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –≠—Ç–∞–ø —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ "‚úì –ê–∫—Ç–∏–≤–µ–Ω"

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. ‚úÖ `db/migrations/0104_add_is_active_to_tender_stages.sql` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
2. ‚úÖ `app/api/tenders/stages/[id]/route.ts` - –æ–±–Ω–æ–≤–ª—ë–Ω API
3. ‚úÖ `components/tenders/settings/stage-modal.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã
4. ‚úÖ `app/(protected)/tenders/settings/tender-settings-complete.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- –≠—Ç–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°—Ç–∞—Ç—É—Å "‚úì –ê–∫—Ç–∏–≤–µ–Ω" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- API –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –ø–æ–ª—è

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
