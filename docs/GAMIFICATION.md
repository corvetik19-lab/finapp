# üéÆ –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –°—Ç—Ä–∏–∫–∏

–°–∏—Å—Ç–µ–º–∞ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —É—Ä–æ–≤–Ω–∏ –∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å—Ç—Ä–∏–∫–∏.

## üèÜ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

1. **–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π** - 20+ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
2. **–£—Ä–æ–≤–Ω–∏ –∏ –æ–ø—ã—Ç (XP)** - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–°—Ç—Ä–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏
4. **–ë–µ–π–¥–∂–∏ –∏ –Ω–∞–≥—Ä–∞–¥—ã** - 4 —Ç–∏—Ä–∞ (–±—Ä–æ–Ω–∑–∞, —Å–µ—Ä–µ–±—Ä–æ, –∑–æ–ª–æ—Ç–æ, –ø–ª–∞—Ç–∏–Ω–∞)
5. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π** - –∫—Ä–∞—Å–∏–≤—ã–π UI —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

---

## üéØ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

### üìù **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
- –ü–µ—Ä–≤—ã–π —à–∞–≥ (1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
- –ù–æ–≤–∏—á–æ–∫ (10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- –ê–∫—Ç–∏–≤–Ω—ã–π (50 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- –ú–∞—Å—Ç–µ—Ä —É—á—ë—Ç–∞ (100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- –õ–µ–≥–µ–Ω–¥–∞ (500 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

### üí∞ **–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è:**
- –¶–µ–ª—å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ (–ø–µ—Ä–≤–∞—è —Ü–µ–ª—å)
- –ú–µ—á—Ç–∞ —Å–±—ã–ª–∞—Å—å (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏)
- –ü–µ—Ä–≤–∞—è 10K (–Ω–∞–∫–æ–ø–∏—Ç—å 10 000 ‚ÇΩ)
- –ú–∞—Å—Ç–µ—Ä –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π (–Ω–∞–∫–æ–ø–∏—Ç—å 100 000 ‚ÇΩ)

### üî• **–°—Ç—Ä–∏–∫–∏:**
- –ù–µ–¥–µ–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥)
- –ú–µ—Å—è—Ü –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (30 –¥–Ω–µ–π)
- –ö–≤–∞—Ä—Ç–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (90 –¥–Ω–µ–π)
- –ì–æ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (365 –¥–Ω–µ–π)

### üíº **–ë—é–¥–∂–µ—Ç—ã:**
- –ü–µ—Ä–≤—ã–π –±—é–¥–∂–µ—Ç
- –ú–∞—Å—Ç–µ—Ä –±—é–¥–∂–µ—Ç–æ–≤ (—Å–æ–±–ª—é–¥–∞—Ç—å 3 –º–µ—Å—è—Ü–∞)

### ‚≠ê **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ:**
- –†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ 8:00)
- –ü–æ–ª—É–Ω–æ—á–Ω–∏–∫ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ—Å–ª–µ 23:00)
- –í—ã—Ö–æ–¥–Ω–æ–π –≤–æ–∏–Ω (10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ)
- –ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç (50 –ø–æ–ª–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

---

## üìä –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π

### **–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞:**
```
level = floor(sqrt(xp / 100)) + 1
```

### **–ü—Ä–∏–º–µ—Ä—ã:**
- 0-99 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 1
- 100-399 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 2
- 400-899 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 3
- 900-1599 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 4
- 1600-2499 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 5

### **–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å XP:**
- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ ‚Üí +10-1000 XP (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏—Ä–∞)
- –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é ‚Üí +1 XP
- –°–æ–±–ª—é—Å—Ç–∏ –±—é–¥–∂–µ—Ç ‚Üí +5 XP
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Üí +2 XP

---

## üéñÔ∏è –¢–∏—Ä—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

| –¢–∏—Ä | –¶–≤–µ—Ç | –ù–∞–≥—Ä–∞–¥–∞ XP | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-----|------|------------|-----------|
| ü•â –ë—Ä–æ–Ω–∑–∞ | #cd7f32 | 10-30 XP | –õ–µ–≥–∫–æ |
| ü•à –°–µ—Ä–µ–±—Ä–æ | #c0c0c0 | 50-100 XP | –°—Ä–µ–¥–Ω–µ |
| ü•á –ó–æ–ª–æ—Ç–æ | #ffd700 | 100-300 XP | –°–ª–æ–∂–Ω–æ |
| üíé –ü–ª–∞—Ç–∏–Ω–∞ | #e5e4e2 | 500-1000 XP | –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ |

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/achievements`
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
3. –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

### **API Endpoints:**

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
GET /api/gamification/achievements
Response: { achievements: AchievementWithProgress[] }

// –ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/gamification/level
Response: { 
  level: UserLevel,
  progress: { current, next, percentage }
}

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∏–∫–∏
GET /api/gamification/streaks
Response: { streaks: ActivityStreak[] }
```

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### **–¢–∞–±–ª–∏—Ü—ã:**

```sql
achievements_definitions  -- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
user_achievements        -- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
activity_streaks         -- –°—Ç—Ä–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_levels              -- –£—Ä–æ–≤–Ω–∏ –∏ XP
```

### **–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**

```sql
INSERT INTO achievements_definitions (
  id, name, description, icon, category, tier, points,
  requirement_type, requirement_value
) VALUES (
  'my_achievement',
  '–ú–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ',
  '–û–ø–∏—Å–∞–Ω–∏–µ',
  'üéØ',
  'special',
  'gold',
  150,
  'count',
  100
);
```

---

## üíª –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### **–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:**

```typescript
import { createRSCClient } from '@/lib/supabase/server';

const supabase = await createRSCClient();
const { data: { user } } = await supabase.auth.getUser();

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ
if (transactionCount >= 10) {
  // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
  await supabase.from('user_achievements').insert({
    user_id: user.id,
    achievement_id: 'transactions_10',
    progress: transactionCount,
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º XP
  await supabase.rpc('add_experience', {
    user_id: user.id,
    xp: 20,
  });
}
```

### **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∏–∫:**

```typescript
const today = new Date().toISOString().split('T')[0];

await supabase.from('activity_streaks').upsert({
  user_id: user.id,
  streak_type: 'daily_transaction',
  last_activity_date: today,
  current_streak: 5,
  longest_streak: 10,
}, {
  onConflict: 'user_id,streak_type',
});
```

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### **–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:**

1. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø–∏—Å—å –≤ `achievements_definitions`
2. –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ
3. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∏–ø—ã TypeScript –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### **–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É —É—Ä–æ–≤–Ω—è:**

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ `db/migrations/020_gamification.sql`:

```sql
CREATE OR REPLACE FUNCTION calculate_level_from_xp(xp INTEGER)
RETURNS INTEGER AS $$
BEGIN
  -- –í–∞—à–∞ —Ñ–æ—Ä–º—É–ª–∞
  RETURN FLOOR(SQRT(xp / 50.0)) + 1;
END;
$$ LANGUAGE plpgsql IMMUTABLE;
```

---

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**

```sql
SELECT 
  ad.name,
  COUNT(ua.id) as unlock_count
FROM achievements_definitions ad
LEFT JOIN user_achievements ua ON ua.achievement_id = ad.id
GROUP BY ad.id, ad.name
ORDER BY unlock_count DESC
LIMIT 10;
```

### **–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

```sql
SELECT 
  AVG(level) as avg_level,
  MAX(level) as max_level,
  AVG(experience_points) as avg_xp
FROM user_levels;
```

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:

- üèÖ –°–µ–∑–æ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- üéÅ –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (—Ç–µ–º—ã, –∏–∫–æ–Ω–∫–∏)
- üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
- üéØ –ß–µ–ª–ª–µ–Ω–¥–∂–∏ —Å –¥–µ–¥–ª–∞–π–Ω–∞–º–∏
- üì± Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö
- üéâ –ê–Ω–∏–º–∞—Ü–∏–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤):**

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE FROM user_achievements WHERE user_id = 'your-user-id';

-- –°–±—Ä–æ—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å
UPDATE user_levels 
SET level = 1, experience_points = 0 
WHERE user_id = 'your-user-id';

-- –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç—Ä–∏–∫–∏
DELETE FROM activity_streaks WHERE user_id = 'your-user-id';
```

---

**–í–µ—Ä—Å–∏—è:** v1.0  
**–î–∞—Ç–∞:** 2025-10-19  
**–ê–≤—Ç–æ—Ä:** FinApp Team
