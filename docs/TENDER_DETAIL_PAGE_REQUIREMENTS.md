# Требования к странице детального просмотра тендера

## Анализ CRM системы (https://ip-domasnix.ztcs.biz/tenders/6621/)

### Структура страницы

#### 1. Шапка страницы
- Номер проекта (Проект № 6621)
- Заказчик с ссылкой на ЕИС
- Текущий этап (бейдж)
- Кнопки действий

#### 2. Вкладки (Tabs)
1. **Основная информация** (активна по умолчанию)
2. **Задачи**
3. **Файлы**
4. **Затраты по контракту**
5. **Контакты контрагентов**

#### 3. Основная информация - Блоки

##### Блок "Начальные данные"
- Проект (текстовое поле)
- № закупки (текстовое поле)
- НМЦК (руб.) (числовое поле)
- Способ определения (текстовое поле)
- Обеспечение заявки (числовое поле)
- ФЗ/ПП (выпадающий список: ФЗ-223, ФЗ-44, ПП-615, ФЗ-275, Коммерческие)
- Обеспечение контракта (числовое поле)
- Предмет закупки (текстовое поле, многострочное)
- Площадка (текстовое поле)
- Ссылка (текстовое поле с кнопкой перехода)
- Дата окончания подачи заявки (дата + время)
- Дата проведения аукциона (дата + время)
- Дата рассмотрения заявки (дата + время)
- Дата подведения итогов (дата + время)

##### Блок "Просчёт тендера"
- Ответственный менеджер (выпадающий список сотрудников)
- Цена (сдать) (руб.) (числовое поле)
- Ответственный тендерный специалист (выпадающий список)
- Процент менеджера (5%) (вычисляемое поле)
- Ответственный исполнитель (выпадающий список)
- Процент инвестора (5%) (вычисляемое поле)
- Закупка (числовое поле)
- Логистика (числовое поле)
- Цена для торгов (числовое поле)
- Прочие затраты (числовое поле)
- Планируемая прибыль (числовое поле)
- Сумма прямых затрат (вычисляемое поле)

##### Блок "Риски"
- Срок поставки по ТЗ (Дней) (числовое поле)
- Факт.сроки поставки (Дней) (числовое поле)
- Место поставки (текстовое поле)
- Количество мест поставки (числовое поле)
- Монтаж (выпадающий список: Да/Нет/Не выбрано)
- Разгрузка (выпадающий список: Да/Нет/Не выбрано)
- Штрафы (текстовое поле)
- Проверка заказчика (текстовое поле)
- Проверка поставщика (текстовое поле)

##### Блок "Обратить внимание"
- Гособорон заказ (выпадающий список: Да/Нет)
- Нац. режим (текстовое поле)
- Условие поставки (выпадающий список: Единовременная поставка / Поэтапная)
- Длительная гарантия (текстовое поле)
- Срок оплаты (текстовое поле)
- Срок приемки (текстовое поле)
- Срок действия контракта (текстовое поле)
- Запросы на разъяснения (текстовое поле)
- Другое (текстовое поле)

##### Блок "Результат"
- Цена контракта (руб.) (числовое поле)
- Прогнозируемая прибыль менеджера (вычисляемое поле)
- Ответственный тендерный специалист (выпадающий список)
- Юр. лицо (выпадающий список)
- Инвестор (переключатель "Показать тендер инвесторам")

#### 4. Правая боковая панель
- **Текущий этап** (название этапа)
- **Кто назначил / Кому назначил** (имена пользователей)
- **Этап начат** (дата и время)
- **Кнопка "Перевести"** (переход на следующий этап)

#### 5. Нижняя панель действий
- Кнопка "Увеличить блок"
- Кнопка "Основные комментарии"
- Кнопка "Добавить комментарий"

### Технические требования

#### База данных
Необходимо добавить следующие поля в таблицу `tenders`:

```sql
-- Начальные данные
procurement_method VARCHAR(200),
application_security NUMERIC,
contract_security NUMERIC,

-- Просчёт
purchase_cost NUMERIC,
logistics_cost NUMERIC,
bid_price NUMERIC,
other_costs NUMERIC,
planned_profit NUMERIC,

-- Риски
delivery_days_tz INTEGER,
delivery_days_actual INTEGER,
delivery_location TEXT,
delivery_locations_count INTEGER,
installation_required BOOLEAN,
unloading_required BOOLEAN,
penalties TEXT,
customer_check TEXT,
supplier_check TEXT,

-- Обратить внимание
is_defense_order BOOLEAN,
national_regime TEXT,
delivery_condition VARCHAR(100),
long_warranty TEXT,
payment_term TEXT,
acceptance_term TEXT,
contract_duration TEXT,
clarification_requests TEXT,
other_notes TEXT,

-- Результат
legal_entity_id UUID REFERENCES legal_entities(id),
show_to_investors BOOLEAN DEFAULT false,

-- Даты
auction_date TIMESTAMPTZ,
review_date TIMESTAMPTZ,
results_date TIMESTAMPTZ
```

#### Компоненты для создания

1. **TenderDetailTabs** - контейнер с вкладками
2. **TenderInfoTab** - вкладка "Основная информация"
3. **TenderTasksTab** - вкладка "Задачи"
4. **TenderFilesTab** - вкладка "Файлы"
5. **TenderCostsTab** - вкладка "Затраты по контракту"
6. **TenderContactsTab** - вкладка "Контакты контрагентов"
7. **TenderSidebar** - правая боковая панель с этапом
8. **TenderActions** - нижняя панель действий

#### Стили
- Использовать CSS Modules
- Адаптивный дизайн (desktop first)
- Цветовая схема: синий (#2563eb) для активных элементов
- Серый (#6b7280) для неактивных
- Белый фон для карточек

#### API endpoints
- `GET /api/tenders/[id]` - получение тендера
- `PATCH /api/tenders/[id]` - обновление тендера
- `POST /api/tenders/[id]/stage` - перевод на следующий этап
- `GET /api/tenders/[id]/tasks` - получение задач
- `GET /api/tenders/[id]/files` - получение файлов
- `GET /api/tenders/[id]/costs` - получение затрат
- `GET /api/tenders/[id]/contacts` - получение контактов

### План реализации

1. ✅ Создать миграцию для добавления новых полей
2. ✅ Обновить типы TypeScript
3. ✅ Создать компонент TenderDetailTabs
4. ⏳ Создать компонент TenderInfoTab с всеми блоками
5. ⏳ Создать компонент TenderSidebar
6. ⏳ Создать остальные вкладки (Tasks, Files, Costs, Contacts)
7. ⏳ Обновить API endpoints
8. ⏳ Интегрировать с существующей страницей тендера
9. ⏳ Тестирование

### Особенности реализации

- Все поля должны быть редактируемыми inline
- Автосохранение при изменении полей
- Валидация данных на клиенте и сервере
- Вычисляемые поля обновляются автоматически
- История изменений сохраняется
- Поддержка прав доступа по ролям
