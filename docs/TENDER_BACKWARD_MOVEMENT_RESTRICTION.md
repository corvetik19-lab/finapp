# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–µ–Ω–¥–µ—Ä–æ–≤ –Ω–∞–∑–∞–¥

**–î–∞—Ç–∞:** 14.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–µ–Ω–¥–µ—Ä–æ–≤ —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥ –ø–æ —ç—Ç–∞–ø–∞–º. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–Ω–¥–µ—Ä—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø. –î–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –Ω–∞–∑–∞–¥ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (allow_backward_movement = false)

‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–æ:**
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (–≤–ø–µ—Ä—ë–¥)
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (–Ω–∞ +1 —ç—Ç–∞–ø)

‚ùå **–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç—Ç–∞–ø (–Ω–∞–∑–∞–¥)
- –ü–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —ç—Ç–∞–ø—ã

### –° –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π (allow_backward_movement = true)

‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–æ:**
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (–≤–ø–µ—Ä—ë–¥)
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç—Ç–∞–ø (–Ω–∞–∑–∞–¥)
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (–Ω–∞ ¬±1 —ç—Ç–∞–ø)

‚ùå **–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- –ü–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —ç—Ç–∞–ø—ã

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0105_add_tender_movement_settings.sql`

```sql
ALTER TABLE tender_notification_settings 
ADD COLUMN IF NOT EXISTS allow_backward_movement boolean DEFAULT false NOT NULL;
```

**–¢–∞–±–ª–∏—Ü–∞:** `tender_notification_settings`
- –ü–æ–ª–µ: `allow_backward_movement` (boolean, default: false)
- –•—Ä–∞–Ω–∏—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ

### 2. API

**Endpoint:** `POST /api/tenders/settings/notifications`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "allow_backward_movement": true
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "data": {
    "user_id": "...",
    "allow_backward_movement": true,
    ...
  }
}
```

### 3. UI - –ù–∞—Å—Ç—Ä–æ–π–∫–∏

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/tenders/settings` ‚Üí –≤–∫–ª–∞–¥–∫–∞ "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `tender-settings-complete.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º —Ç–µ–Ω–¥–µ—Ä–æ–≤" —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º:

```tsx
<SettingItem
  icon="‚¨ÖÔ∏è"
  label="–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥"
  description="–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä—ã –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —ç—Ç–∞–ø—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥)"
  checked={settings.allow_backward_movement}
  onChange={() => onToggle('allow_backward_movement')}
/>
```

**–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

### 4. –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `TenderKanban`

**Prop:** `allowBackwardMovement?: boolean`

**–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```typescript
const canMoveToStage = (fromStageId: string, toStageId: string): boolean => {
  // ... –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
  
  const isMovingBackward = toIndex < fromIndex;
  
  // –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥ –∏ —ç—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ - –±–ª–æ–∫–∏—Ä—É–µ–º
  if (isMovingBackward && !allowBackwardMovement) {
    return false;
  }
  
  return Math.abs(toIndex - fromIndex) === 1;
};
```

**–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ:**
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∞–∑–∞–¥: "–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥ –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –í–∫–ª—é—á–∏—Ç–µ '–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥' –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö..."
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É—Ç—å: "–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ —ç—Ç–∞–ø—ã. –ü–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ."

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–°—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∫–∞–Ω–±–∞–Ω–æ–º:**
- `/tenders/department` - –¢–µ–Ω–¥–µ—Ä–Ω—ã–π –æ—Ç–¥–µ–ª
- `/tenders/realization` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```typescript
const loadSettings = async () => {
  const response = await fetch('/api/tenders/settings/notifications');
  const result = await response.json();
  setAllowBackwardMovement(result.data?.allow_backward_movement || false);
};
```

**–ü–µ—Ä–µ–¥–∞—á–∞ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
```tsx
<TenderKanban
  tendersByStage={tendersByStage}
  stages={stages}
  onStageChange={handleStageChange}
  allowBackwardMovement={allowBackwardMovement}
/>
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ `/tenders/settings`
2. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü–∏–∏ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º —Ç–µ–Ω–¥–µ—Ä–æ–≤"
4. –í–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥"
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä—ã –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç—Ç–∞–ø

### –û—Ç–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ `/tenders/settings`
2. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. –í—ã–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥

## –§–∞–π–ª—ã

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
- `db/migrations/0105_add_tender_movement_settings.sql`

**API:**
- `app/api/tenders/settings/notifications/route.ts`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `components/tenders/tender-kanban.tsx` - –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `app/(protected)/tenders/settings/tender-settings-complete.tsx` - UI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `app/(protected)/tenders/department/tender-department-client.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `app/(protected)/tenders/realization/tender-realization-client.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–∞:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤ –Ω–∞–∑–∞–¥
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤

‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:**
- –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

‚úÖ **UX:**
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

## –ü—Ä–∏–º–µ—Ä—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–ø–µ—Ä—ë–¥ (–≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)

```
–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø: "–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ—Å—á—ë—Ç" (order_index: 1)
–¶–µ–ª–µ–≤–æ–π —ç—Ç–∞–ø: "–ü—Ä–æ–≤–µ—Ä–∫–∞" (order_index: 2)
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø—Ä–µ—â–µ–Ω–æ)

```
–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø: "–ü—Ä–æ–≤–µ—Ä–∫–∞" (order_index: 2)
–¶–µ–ª–µ–≤–æ–π —ç—Ç–∞–ø: "–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ—Å—á—ë—Ç" (order_index: 1)
allow_backward_movement: false
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ
–°–æ–æ–±—â–µ–Ω–∏–µ: "–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥ –∑–∞–ø—Ä–µ—â–µ–Ω–æ..."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞–∑–∞–¥ (—Å –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π)

```
–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø: "–ü—Ä–æ–≤–µ—Ä–∫–∞" (order_index: 2)
–¶–µ–ª–µ–≤–æ–π —ç—Ç–∞–ø: "–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ—Å—á—ë—Ç" (order_index: 1)
allow_backward_movement: true
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ (–≤—Å–µ–≥–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–æ)

```
–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø: "–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ—Å—á—ë—Ç" (order_index: 1)
–¶–µ–ª–µ–≤–æ–π —ç—Ç–∞–ø: "–ü–æ–¥–∞—á–∞" (order_index: 3)
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ
–°–æ–æ–±—â–µ–Ω–∏–µ: "–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ —ç—Ç–∞–ø—ã..."
```

## –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ production.
