# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Gemini AI –≤ —Ä–µ–∂–∏–º –§–∏–Ω–∞–Ω—Å—ã

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Gemini 3 API –≤ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ä–µ–∂–∏–º–∞ –§–∏–Ω–∞–Ω—Å—ã —Å Function Calling –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ö–ª—é—á–µ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≥–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: API routes –Ω–∞ Vercel –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –≤ US —Ä–µ–≥–∏–æ–Ω–∞—Ö, —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ö–æ–¥–∏—Ç –≥–µ–æ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Gemini API.

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ö–ª–∏–µ–Ω—Ç        ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Vercel API      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Gemini API     ‚îÇ
‚îÇ   (–ë—Ä–∞—É–∑–µ—Ä)     ‚îÇ     ‚îÇ  (US Region)     ‚îÇ     ‚îÇ  (Google)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  Supabase DB     ‚îÇ
                        ‚îÇ  (–§–∏–Ω–∞–Ω—Å—ã)       ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- Vercel Serverless Functions –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–µ–≥–∏–æ–Ω–∞—Ö `iad1` (Washington DC) –∏–ª–∏ `sfo1` (San Francisco)
- Gemini API –¥–æ—Å—Ç—É–ø–µ–Ω –≤ US –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω—ã ‚Üí Vercel (US) ‚Üí Gemini API ‚úÖ

---

## 2. –ú–æ–¥–µ–ª–∏ Gemini 3

| –ú–æ–¥–µ–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|-----------|-------------|
| `gemini-2.0-flash` | –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç | –ë—ã—Å—Ç—Ä—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Function Calling |
| `gemini-2.5-flash` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ | –ù–æ–≤–µ–π—à–∞—è flash –º–æ–¥–µ–ª—å |
| `gemini-2.5-pro` | –°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ | Deep Thinking, –ª—É—á—à–∏–π –∞–Ω–∞–ª–∏–∑ |

**–í—ã–±–æ—Ä**: `gemini-2.0-flash` - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.

---

## 3. Function Calling - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 3.1 –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (GET)

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|---------|----------|-----------|
| `getAccounts` | –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤ | - |
| `getAccountBalance` | –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–æ–≤ | accountId? |
| `getTransactions` | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | limit?, startDate?, endDate?, categoryId? |
| `getCategories` | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ | type? (income/expense) |
| `getBudgets` | –ë—é–¥–∂–µ—Ç—ã | period? |
| `getPlans` | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–ª–∞–Ω—ã | - |
| `getFinancialSummary` | –°–≤–æ–¥–∫–∞ | period (week/month/year) |
| `getExpensesByCategory` | –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º | startDate?, endDate?, month?, year? |
| `searchTransactions` | RAG –ø–æ–∏—Å–∫ | query |

### 3.2 –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (POST)

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|---------|----------|-----------|
| `addTransaction` | –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é | amount, direction, categoryName, accountName, description?, date? |
| `addCategory` | –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é | name, type |
| `addBudget` | –°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç | categoryName, amount, period |
| `addPlan` | –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω | name, targetAmount, currentAmount, deadline? |
| `addDebitCard` | –î–æ–±–∞–≤–∏—Ç—å –¥–µ–±–µ—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É | name, balance, currency?, bank? |
| `addCreditCard` | –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç–Ω—É—é –∫–∞—Ä—Ç—É | name, balance, creditLimit, currency?, bank? |

### 3.3 –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (AI)

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|---------|----------|-----------|
| `analyzeSpending` | –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ç | period |
| `predictExpenses` | –ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤ | months |
| `getSavingsAdvice` | –°–æ–≤–µ—Ç—ã –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏ | - |
| `detectAnomalies` | –í—ã—è–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π | - |

---

## 4. –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 4.1 `lib/ai/gemini-client.ts`
- –£–±—Ä–∞—Ç—å Vertex AI
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `GEMINI_API_KEY`
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞

### 4.2 `app/api/ai/chat/route.ts`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `preferredRegion` –¥–ª—è Vercel
- –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ `gemini-2.0-flash`
- –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É Function Calling
- –î–æ–±–∞–≤–∏—Ç—å streaming –æ—Ç–≤–µ—Ç–æ–≤

### 4.3 `lib/ai/tools.ts`
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 4.4 `lib/ai/tool-handlers.ts`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –£–ª—É—á—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

### 4.5 `app/(protected)/ai-chat/Chat.tsx`
- –£–ª—É—á—à–∏—Ç—å UI
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã Function Calling
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AI

---

## 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vercel

### 5.1 API Route —Å —Ä–µ–≥–∏–æ–Ω–æ–º
```typescript
// app/api/ai/chat/route.ts
export const runtime = "nodejs";
export const maxDuration = 60;
export const preferredRegion = ["iad1"]; // Washington DC - –±–ª–∏–∂–µ –∫ Google
```

### 5.2 Environment Variables (Vercel Dashboard)
```
GEMINI_API_KEY=AIza...
```

---

## 6. System Prompt

```
–¢—ã ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FinApp.

–í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
- –ê–Ω–∞–ª–∏–∑ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–≤
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò–ù–°–¢–†–£–ú–ï–ù–¢–´:
–ò—Å–ø–æ–ª—å–∑—É–π Function Calling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
- getAccountBalance - —É–∑–Ω–∞—Ç—å –±–∞–ª–∞–Ω—Å
- getTransactions - –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- getExpensesByCategory - –∞–Ω–∞–ª–∏–∑ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- addTransaction - –∑–∞–ø–∏—Å–∞—Ç—å —Ä–∞—Å—Ö–æ–¥/–¥–æ—Ö–æ–¥
- –∏ –¥—Ä—É–≥–∏–µ...

–ü–†–ê–í–ò–õ–ê:
1. –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π)
2. –°—É–º–º—ã –≤ –†–£–ë–õ–Ø–• (–Ω–µ –∫–æ–ø–µ–π–∫–∞—Ö)
3. direction="expense" –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤, "income" –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤
4. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —Å —ç–º–æ–¥–∑–∏ (üí∞ üìä ‚úÖ ‚ùå üìà üìâ)
5. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö - –æ–±—ä—è—Å–Ω–∏ –ø–æ–Ω—è—Ç–Ω–æ

–ü–†–ò–ú–ï–†–´:
- "–°–∫–æ–ª—å–∫–æ —è –ø–æ—Ç—Ä–∞—Ç–∏–ª?" ‚Üí –≤—ã–∑–æ–≤–∏ getFinancialSummary
- "–î–æ–±–∞–≤—å —Ä–∞—Å—Ö–æ–¥ 500—Ä –Ω–∞ –∫–∞—Ñ–µ" ‚Üí –≤—ã–∑–æ–≤–∏ addTransaction
- "–ü–æ–∫–∞–∂–∏ —Ç—Ä–∞—Ç—ã –∑–∞ –Ω–µ–¥–µ–ª—é" ‚Üí –≤—ã–∑–æ–≤–∏ getTransactions
```

---

## 7. –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (5 –º–∏–Ω)
- [x] –£–±—Ä–∞—Ç—å Vertex AI –∏–∑ gemini-client.ts
- [x] –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ API Key

### –≠—Ç–∞–ø 2: API Route (10 –º–∏–Ω)
- [x] –î–æ–±–∞–≤–∏—Ç—å preferredRegion
- [x] –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å
- [x] –£–ª—É—á—à–∏—Ç—å streaming

### –≠—Ç–∞–ø 3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (15 –º–∏–Ω)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ tools
- [x] –û–±–Ω–æ–≤–∏—Ç—å convert-tools.ts

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5 –º–∏–Ω)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
- [ ] Commit & Push
- [ ] –¢–µ—Å—Ç –Ω–∞ Vercel

---

## 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
1. "–ü—Ä–∏–≤–µ—Ç" - –±–∞–∑–æ–≤—ã–π –æ—Ç–≤–µ—Ç
2. "–°–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –¥–µ–Ω–µ–≥?" - getAccountBalance
3. "–ü–æ–∫–∞–∂–∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –º–µ—Å—è—Ü" - getExpensesByCategory
4. "–î–æ–±–∞–≤—å —Ä–∞—Å—Ö–æ–¥ 100—Ä –Ω–∞ —Ç–∞–∫—Å–∏" - addTransaction
5. "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–∏ —Ç—Ä–∞—Ç—ã" - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

---

## 9. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤ —Ä–µ–∂–∏–º–µ –§–∏–Ω–∞–Ω—Å—ã –±—É–¥–µ—Ç:
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –∏–∑ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω—ã (—á–µ—Ä–µ–∑ Vercel US)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gemini 2.0 Flash
- ‚úÖ –í—ã–ø–æ–ª–Ω—è—Ç—å Function Calling –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–º/—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –î–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
