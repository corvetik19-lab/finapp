# Ручное тестирование CSV-импорта

## Подготовка окружения

- Dev-сервер: `npm run dev`
- Пользователь: авторизованный (Supabase magic link или гость, если разрешено)
- Наличие хотя бы одного счёта и категорий (для проверки маппинга)

## Тестовые файлы

- `valid.csv` — содержит корректные строки
- `mixed.csv` — содержит ошибки, дубликаты, несовпадающие валюты, неизвестные категории

### Формат CSV

```csv
Дата;Тип;Сумма;Валюта;Счёт;Категория;Контрагент;Заметка
2025-09-01T10:00:00Z;income;1000;RUB;Карта;Зарплата;Компания;Комментарий
...
```

## Процедура

1. Открыть `/transactions` и нажать кнопку «Импорт».
2. В модалке перетащить `valid.csv` или выбрать вручную.
   - Убедиться, что отображается предпросмотр первых строк, подсчёт «Готовы к импорту» и сообщение об отсутствии ошибок.
3. Нажать «Импортировать N».
   - Ожидать закрытие модалки, всплывающего сообщения об успехе (в футере модалки до закрытия) и обновления списка транзакций.
   - Проверить, что новые записи появились в таблице и на графиках `/reports`.
4. Повторно импортировать тот же файл.
   - Ожидать, что дубликаты будут пропущены, сообщение содержит «Дубликатов пропущено».
5. Импортировать `mixed.csv`.
   - Проверить, что модалка отображает список ошибок (неизвестный счёт, несуществующая категория, неверная валюта, формат даты/суммы).
   - Убедиться, что кнопка «Импортировать» отключена, пока есть ошибки.
6. Исправить `mixed.csv` (например, удалить строки с ошибками) и импортировать снова.
   - Убедиться, что корректные строки импортируются, а ошибки больше не отображаются.
7. Проверить дедупликацию в рамках одного файла: добавить две одинаковые строки.
   - Убедиться, что модалка завершает импорт с сообщением о пропущенном дубликате.
8. Проверить экспорт:
   - Настроить фильтры (например, период/категорию) и нажать «Экспорт».
   - Убедиться, что скачанный файл имеет корректное имя и содержит только отфильтрованные строки.
   - Проверить, что названия счёта/категории подтянулись корректно, суммы имеют два знака после запятой.

## Ожидаемые результаты

- Все суммы и даты нормализуются (время в UTC), видимы на странице транзакций.
- Тултипы и карточки статистики (`SummaryWithPeriod`, `/reports`) обновляются после `router.refresh()`.
- Нет ошибок в консоли браузера и терминале.

## Follow-up

- Добавить тесты Playwright: сценарий загрузки `valid.csv`, проверка появления транзакций.
- Написать автотест экспортного сценария (скачивание и проверка содержимого).
