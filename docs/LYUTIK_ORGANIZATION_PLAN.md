# План доработки организации Лютик

## Общая информация

- **Организация:** Лютик
- **Режим:** ИИ Студия (ai_studio)
- **Админ:** `lyutik@yandex.ru` / `lyutik123`
- **Пользователь чата:** `chat@lyutik.ru` / `chat123`

---

## Задачи

### 1. Режимы организации (только супер-админ) ✅

- [x] Убрать возможность изменения режимов в /admin/settings/modes для админа организации
- [x] Режимы может менять только супер-админ при создании/редактировании организации
- [x] Показывать режимы только для просмотра для админа организации

### 2. Информация об организации (/admin/settings/overview) ✅

- [x] Убрать поле Slug
- [x] Добавить больше важной информации
- [x] Исправить отображение количества участников (сейчас 0, должен быть 1+)
- [x] Улучшить дизайн страницы

### 3. Модули в настройках ✅

- [x] Показывать только доступные режимы организации
- [x] Для Лютик: убрать "Настройка тендеров", показать "Настройка ИИ Студии"
- [x] Динамически формировать список модулей на основе allowed_modes

### 4. Настройки для каждого режима ✅

- [x] ИИ Студия: убрать "Интеграция" (нужна только в Тендерах)
- [x] Сделать настройки актуальными для каждого режима
- [x] Создана страница /admin/settings/modes/ai-studio

### 5. Страница Подписка (/admin/settings/subscription) ✅

- [x] Показать детали подписки организации
- [x] Список пользователей и их количество
- [x] Информация о плане, периоде, стоимости
- [x] Даты начала/окончания подписки
- [x] Включённые режимы организации
- [x] Информация об организации

### 6. Переключатель режимов ✅

- [x] Если один режим - не показывать выпадающий список
- [x] При возврате из настроек - направлять в правильный режим (не /dashboard с Финансами)
- [x] Скрыть режимы, не назначенные организации

### 7. Создание роли для ИИ Студии ✅

- [x] Создать роль "Пользователь Gemini Chat"
- [x] Ограничить доступ только к /ai-studio/chat
- [x] Настроить allowed_modes и permissions

### 8. Создание пользователя с ролью ✅

- [x] Создать нового пользователя для организации Лютик (<chat@lyutik.ru>)
- [x] Назначить созданную роль

### 9. Сотрудники ✅

- [x] Добавить пункт "Сотрудники" в меню ИИ Студии
- [x] Создать страницу /ai-studio/employees
- [x] Создать сотрудников: админ и нового пользователя

### 10. Разделение профиля и настроек организации ✅

- [x] /admin/settings/profile - личные настройки пользователя (добавлен в навигацию)
- [x] /admin/settings/overview - настройки организации
- [x] Добавлена секция "Личные" в AdminSettingsNav с пунктом "Мой профиль"

---

## Прогресс выполнения

### Этап 1: Исправление режимов и настроек ✅

- [x] Начато: 20.12.2024
- [x] Завершено: 20.12.2024

### Этап 2: Страницы информации и подписки ✅

- [x] Начато: 20.12.2024
- [x] Завершено: 20.12.2024

### Этап 3: Переключатель режимов ✅

- [x] Начато: 20.12.2024
- [x] Завершено: 20.12.2024

### Этап 4: Роли и пользователи ✅

- [x] Начато: 20.12.2024
- [x] Завершено: 20.12.2024

### Этап 5: Сотрудники и меню ✅

- [x] Начато: 20.12.2024
- [x] Завершено: 20.12.2024

---

## Созданные файлы

- `app/(protected)/admin/settings/modes/ai-studio/page.tsx` - настройки ИИ Студии
- `app/(protected)/ai-studio/employees/page.tsx` - страница сотрудников (серверный компонент)
- `app/(protected)/ai-studio/employees/EmployeesList.tsx` - список сотрудников (клиентский компонент с модалкой)
- `app/(protected)/ai-studio/employees/EmployeeModal.tsx` - модалка редактирования/удаления сотрудника

## Изменённые файлы

- `components/platform/ModeSwitcher.tsx` - исправлен переключатель режимов
- `components/settings/AdminSettingsNav.tsx` - динамические модули по allowed_modes
- `app/(protected)/admin/settings/layout.tsx` - передача allowedModes
- `app/(protected)/ai-studio/components/Sidebar.tsx` - добавлены Сотрудники и Настройки, меню свёрнуто по умолчанию
- `components/admin/OrgModesManager.tsx` - режимы только для просмотра
- `components/settings/OrganizationSettings.tsx` - убран Slug
- `lib/platform/modes-config.ts` - изменён ключ ai-studio на ai_studio
- `lib/platform/mode-registry.ts` - изменён ключ ai-studio на ai_studio
- `lib/platform/platform-settings.ts` - изменён ключ ai-studio на ai_studio
- `lib/organizations/types.ts` - изменён тип AppMode (ai-studio → ai_studio)
- `app/(protected)/dashboard/page.tsx` - исправлен редирект для ai_studio

## Дополнительные улучшения (20.12.2024)

- ✅ Меню "Инструменты AI" свёрнуто по умолчанию
- ✅ Добавлено меню с тремя точками для каждого сотрудника (Редактировать/Удалить)
- ✅ Модалка редактирования сотрудника как в тендерах (общий компонент EmployeeFormModal)
- ✅ Роль в системе нередактируемая - берётся из настроек пользователя
- ✅ Секции: Персональные данные, Рабочие данные, Дополнительно
- ✅ Поля: ФИО, Email, Телефон, Telegram, Дата рождения, Должность, Отдел, Статус, Дата приёма, График работы, Заметки
- ✅ Кнопка удаления с подтверждением AlertDialog
- ✅ Поиск сотрудников по имени, email, должности

## Улучшения страницы Подписка (20.12.2024)

- ✅ Реальные данные организации вместо заглушки
- ✅ Динамический расчёт плана на основе режимов
- ✅ Список пользователей с аватарами и ролями
- ✅ Включённые режимы организации
- ✅ Информация об организации (название, дата создания, ID)

## Разделение профиля и настроек (20.12.2024)

- ✅ Добавлена секция "Личные" в навигацию AdminSettingsNav
- ✅ Пункт "Мой профиль" ведёт на /admin/settings/profile
