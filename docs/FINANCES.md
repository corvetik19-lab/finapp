# üí∞ –†–µ–∂–∏–º "–§–∏–Ω–∞–Ω—Å—ã" ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
> **–í–µ—Ä—Å–∏—è:** 1.0.0  
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ù–æ—è–±—Ä—å 2025

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
4. [–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Å—á–µ—Ç–∞](#—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏-–∏-—Å—á–µ—Ç–∞)
5. [–ë—é–¥–∂–µ—Ç—ã –∏ –ø–ª–∞–Ω—ã](#–±—é–¥–∂–µ—Ç—ã-–∏-–ø–ª–∞–Ω—ã)
6. [–ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏ –∫—É–±—ã—à–∫–∞](#–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ-–∫–∞—Ä—Ç—ã-–∏-–∫—É–±—ã—à–∫–∞)
7. [AI-—Ñ—É–Ω–∫—Ü–∏–∏](#ai-—Ñ—É–Ω–∫—Ü–∏–∏)
8. [–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è](#–≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è)
9. [–û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º](#–æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º)
10. [–í–∏–¥–∂–µ—Ç—ã –∏ –¥–∞—à–±–æ—Ä–¥](#–≤–∏–¥–∂–µ—Ç—ã-–∏-–¥–∞—à–±–æ—Ä–¥)
11. [–û–Ω–±–æ—Ä–¥–∏–Ω–≥](#–æ–Ω–±–æ—Ä–¥–∏–Ω–≥)
12. [–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã](#–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è-–≤–∞–ª—é—Ç—ã)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–µ–∂–∏–º "–§–∏–Ω–∞–Ω—Å—ã" ‚Äî –ª–∏—á–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä –¥–ª—è —É—á—ë—Ç–∞ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞–º–∏, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π AI-—Ñ—É–Ω–∫—Ü–∏–π –∏ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –£—á—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã/–ø–µ—Ä–µ–≤–æ–¥—ã)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –∏ –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏
- ‚úÖ –ë—é–¥–∂–µ—Ç—ã —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ –ü–ª–∞–Ω—ã –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è (—Ü–µ–ª–∏)
- ‚úÖ –ö—É–±—ã—à–∫–∞ (–æ–≤–µ—Ä–¥—Ä–∞—Ñ—Ç/–ª–∏–º–∏—Ç)
- ‚úÖ AI-–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —á–µ–∫–æ–≤ —á–µ—Ä–µ–∑ AI
- ‚úÖ –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —É—Ä–æ–≤–Ω–∏, —Å—Ç—Ä–∏–∫–∏)
- ‚úÖ –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ (–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã, –∫—Ä–µ–¥–∏—Ç—ã)
- ‚úÖ –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –≤–∏–¥–∂–µ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
app/(protected)/finance/
‚îú‚îÄ‚îÄ dashboard/              # –ì–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –≤–∏–¥–∂–µ—Ç–∞–º–∏
‚îú‚îÄ‚îÄ transactions/           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
‚îú‚îÄ‚îÄ cards/                  # –°—á–µ—Ç–∞ –∏ –∫–∞—Ä—Ç—ã
‚îú‚îÄ‚îÄ credit-cards/           # –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã
‚îú‚îÄ‚îÄ budgets/                # –ë—é–¥–∂–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
‚îú‚îÄ‚îÄ plans/                  # –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ loans/                  # –ö—Ä–µ–¥–∏—Ç—ã –∏ –∑–∞–π–º—ã
‚îú‚îÄ‚îÄ payments/               # –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏
‚îú‚îÄ‚îÄ analytics/              # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏
‚îú‚îÄ‚îÄ forecasts/              # –ü—Ä–æ–≥–Ω–æ–∑—ã
‚îú‚îÄ‚îÄ reports/                # –û—Ç—á—ë—Ç—ã
‚îú‚îÄ‚îÄ receipts/               # –ü–∞—Ä—Å–∏–Ω–≥ —á–µ–∫–æ–≤
‚îú‚îÄ‚îÄ settings/               # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞
‚îî‚îÄ‚îÄ layout.tsx              # Layout —Ä–µ–∂–∏–º–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤

app/api/
‚îú‚îÄ‚îÄ transactions/           # CRUD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îú‚îÄ‚îÄ accounts/               # –°—á–µ—Ç–∞
‚îú‚îÄ‚îÄ categories/             # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ budgets/                # –ë—é–¥–∂–µ—Ç—ã
‚îú‚îÄ‚îÄ plans/                  # –ü–ª–∞–Ω—ã
‚îú‚îÄ‚îÄ upcoming-payments/      # –ü–ª–∞—Ç–µ–∂–∏
‚îú‚îÄ‚îÄ gamification/           # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —É—Ä–æ–≤–Ω–∏
‚îú‚îÄ‚îÄ ai/                     # AI-—Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ categorize/         # –ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ smart-categorize/   # –£–º–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ process-receipt/    # –ü–∞—Ä—Å–∏–Ω–≥ —á–µ–∫–æ–≤
‚îú‚îÄ‚îÄ cron/                   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ auto-payments/      # –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îî‚îÄ‚îÄ credit-card-payments/
‚îî‚îÄ‚îÄ dashboard/
    ‚îî‚îÄ‚îÄ widget-order/       # –ü–æ—Ä—è–¥–æ–∫ –≤–∏–¥–∂–µ—Ç–æ–≤

components/
‚îú‚îÄ‚îÄ transactions/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îú‚îÄ‚îÄ budgets/                # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—é–¥–∂–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ cards/                  # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç
‚îú‚îÄ‚îÄ dashboard/              # –í–∏–¥–∂–µ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ receipts/               # –ú–æ–¥–∞–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ–∫–æ–≤
‚îú‚îÄ‚îÄ onboarding/             # –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ offline/                # –û—Ñ–ª–∞–π–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
‚îî‚îÄ‚îÄ gamification/           # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

lib/
‚îú‚îÄ‚îÄ transactions/           # –°–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îú‚îÄ‚îÄ budgets/                # –°–µ—Ä–≤–∏—Å –±—é–¥–∂–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ plans/                  # –°–µ—Ä–≤–∏—Å –ø–ª–∞–Ω–æ–≤
‚îú‚îÄ‚îÄ ai/                     # AI-—Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ offline/                # –û—Ñ–ª–∞–π–Ω –æ—á–µ—Ä–µ–¥—å
‚îî‚îÄ‚îÄ dashboard/preferences/  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∂–µ—Ç–æ–≤
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

```sql
-- –°—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
accounts (
  id, user_id, name, type, balance, currency,
  credit_limit, next_payment_date, min_payment,
  icon, color, is_hidden, deleted_at
)

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
transactions (
  id, user_id, account_id, category_id,
  amount, currency, direction,  -- income/expense/transfer
  occurred_at, note, counterparty,
  embedding,  -- pgvector –¥–ª—è AI
  deleted_at
)

-- –ü–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
transaction_items (
  id, transaction_id, product_item_id,
  quantity, price_per_unit, total
)

-- –¢–æ–≤–∞—Ä—ã (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
product_items (
  id, user_id, name, category_id, is_active
)

-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
categories (
  id, user_id, name, type, icon, color,
  parent_id, is_system
)

-- –ë—é–¥–∂–µ—Ç—ã
budgets (
  id, user_id, category_id,
  amount, period, start_date
)

-- –ü–ª–∞–Ω—ã –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
plans (
  id, user_id, name, target, accumulated,
  deadline, icon
)

-- –ö—É–±—ã—à–∫–∏ (–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å—á–µ—Ç–∞–º)
account_stashes (
  id, account_id, target_amount, balance
)

-- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏
upcoming_payments (
  id, user_id, name, due_date,
  amount_minor, currency, status,
  account_name, direction, description
)

-- –ö—Ä–µ–¥–∏—Ç—ã
loans (
  id, user_id, name, principal, interest_rate,
  monthly_payment, next_payment_date, status
)
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–∞—à–±–æ—Ä–¥

**8 –≤–∏–¥–∂–µ—Ç–æ–≤:**

| –í–∏–¥–∂–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| üí∞ –ë—é–¥–∂–µ—Ç –Ω–∞ –º–µ—Å—è—Ü | –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º |
| üìà –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ | –ì—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤ |
| ü•ß –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º | –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ |
| üíé –ß–∏—Å—Ç—ã–µ –∞–∫—Ç–∏–≤—ã | –û–±–∑–æ—Ä –∞–∫—Ç–∏–≤–æ–≤ –∏ –¥–æ–ª–≥–æ–≤ |
| üéØ –ü–ª–∞–Ω—ã | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏ |
| üìÖ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏ | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è |
| üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ | –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø |
| üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ | –†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π |

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∂–µ—Ç–æ–≤:**
- –°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –ª—é–±–æ–π –≤–∏–¥–∂–µ—Ç
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤ –ë–î
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

## –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Å—á–µ—Ç–∞

### –¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

| –¢–∏–ø | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|-------------|----------|
| –î–æ—Ö–æ–¥ | `income` | –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ |
| –†–∞—Å—Ö–æ–¥ | `expense` | –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ |
| –ü–µ—Ä–µ–≤–æ–¥ | `transfer` | –ú–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ |

### –ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è

**–ê–ª–≥–æ—Ä–∏—Ç–º —É–º–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏:**

1. –°–æ–∑–¥–∞–Ω–∏–µ embedding –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
2. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (pgvector)
3. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (>70% –≤ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
4. GPT —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–µ—Å–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ—è–≤–Ω—ã–π)
5. Fallback –Ω–∞ –ø—Ä–æ—Å—Ç—É—é GPT –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é

```typescript
// API
POST /api/ai/smart-categorize
{
  "description": "–ü–æ–∫—É–ø–∫–∞ –∫–æ—Ñ–µ –≤ Starbucks",
  "threshold": 0.75
}

// –û—Ç–≤–µ—Ç
{
  "categoryId": "uuid",
  "categoryName": "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã",
  "confidence": 0.92,
  "explanation": "–ù–∞–π–¥–µ–Ω–æ 5 –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π..."
}
```

### –ü–∞—Ä—Å–∏–Ω–≥ —á–µ–∫–æ–≤

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç —á–µ–∫–∞
2. OpenAI GPT-4o-mini –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. AI-—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ë–î
5. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
- –î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏
- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞)
- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞

```typescript
POST /api/ai/process-receipt
{
  "receiptText": "–ü—è—Ç—ë—Ä–æ—á–∫–∞\n10.11.2025\n–û–Ω–∏–≥–∏—Ä–∏ 2—à—Ç x 89.90...",
  "preview": true  // —Ä–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
}
```

---

## –ë—é–¥–∂–µ—Ç—ã –∏ –ø–ª–∞–Ω—ã

### –ë—é–¥–∂–µ—Ç—ã

- –õ–∏–º–∏—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ –ø–µ—Ä–∏–æ–¥
- –ü–µ—Ä–∏–æ–¥—ã: –º–µ—Å—è—Ü, –Ω–µ–¥–µ–ª—è, –≥–æ–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Å—á—ë—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–≥–æ
- –í–∏–∑—É–∞–ª—å–Ω—ã–π progress bar
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏

### –ü–ª–∞–Ω—ã –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è

- –¶–µ–ª—å —Å —Ü–µ–ª–µ–≤–æ–π —Å—É–º–º–æ–π –∏ –¥–µ–¥–ª–∞–π–Ω–æ–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ `goal_achieved` –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

---

## –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏ –∫—É–±—ã—à–∫–∞

### –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã

**–ü–æ–ª—è:**
- `credit_limit` ‚Äî –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç
- `balance` ‚Äî —Ç–µ–∫—É—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å
- `next_payment_date` ‚Äî –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
- `min_payment` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç—ë–∂

### –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏

**–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 10 –¥–Ω–µ–π –¥–æ —Å—Ä–æ–∫–∞:**

```
CRON: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 9:00 UTC (12:00 –ú–°–ö)
Endpoint: /api/cron/auto-payments
```

**–£—Å–ª–æ–≤–∏—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- –ï—Å—Ç—å –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å (`balance > 0`)
- –£–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
- –î–æ –ø–ª–∞—Ç–µ–∂–∞ ‚â§ 10 –¥–Ω–µ–π
- –ü–ª–∞—Ç—ë–∂ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω

**–°–æ–∑–¥–∞–≤–∞–µ–º—ã–π –ø–ª–∞—Ç—ë–∂:**
```
–ù–∞–∑–≤–∞–Ω–∏–µ: "–ü–ª–∞—Ç—ë–∂ –ø–æ –∫–∞—Ä—Ç–µ: [–ù–∞–∑–≤–∞–Ω–∏–µ]"
–°—É–º–º–∞: max(min_payment, balance)
–°—Ç–∞—Ç—É—Å: pending
```

### –ö—É–±—ã—à–∫–∞ (Stash)

**–ß—Ç–æ —ç—Ç–æ:** –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –æ—Ç –±–∞–Ω–∫–∞ (–æ–≤–µ—Ä–¥—Ä–∞—Ñ—Ç).

**–ü—Ä–∞–≤–∏–ª–∞:**
- `target_amount` = –ª–∏–º–∏—Ç (–Ω–µ–∏–∑–º–µ–Ω–µ–Ω)
- `balance` = –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ = `target_amount - balance`

**–ü—Ä–∏ —Ä–∞—Å—Ö–æ–¥–µ:**
1. –ï—Å–ª–∏ –Ω–∞ –∫–∞—Ä—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä—É—Ç—Å—è –¥–µ–Ω—å–≥–∏ –∏–∑ –∫—É–±—ã—à–∫–∏
3. –ö–∞—Ä—Ç–∞ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–ï–†–ï–î —Å–ø–∏—Å–∞–Ω–∏–µ–º
4. –ö–∞—Ä—Ç–∞ **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å

**–ü—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏:**
1. –ï—Å–ª–∏ –∫—É–±—ã—à–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å
2. –î–µ–Ω—å–≥–∏ –°–ù–ê–ß–ê–õ–ê –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–æ–ª–≥ –∫—É–±—ã—à–∫–µ
3. –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∏–¥—É—Ç –Ω–∞ –∫–∞—Ä—Ç—É

**–¢—Ä–∏–≥–≥–µ—Ä—ã –ë–î:**
- `trigger_auto_withdraw_from_stash` ‚Äî –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ
- `trigger_auto_stash_rollback_on_delete` ‚Äî –æ—Ç–∫–∞—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

---

## AI-—Ñ—É–Ω–∫—Ü–∏–∏

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| –ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é |
| –£–º–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è | –° —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ (embeddings) |
| –ü–∞—Ä—Å–∏–Ω–≥ —á–µ–∫–æ–≤ | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ–∫–∞ |
| AI-—á–∞—Ç | –í–æ–ø—Ä–æ—Å—ã –æ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö |
| –ò–Ω—Å–∞–π—Ç—ã | –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤ |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```env
OPENAI_API_KEY=sk-...
```

**–ú–æ–¥–µ–ª–∏:**
- GPT-4o-mini ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–∞—Ä—Å–∏–Ω–≥
- text-embedding-3-large ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

### pgvector

–î–ª—è —É–º–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector:

```sql
CREATE FUNCTION match_transactions(
  query_embedding vector(1536),
  match_threshold float,
  match_count int,
  filter_user_id uuid
) RETURNS TABLE (...);
```

---

## –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è

### –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

**20+ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:**

**üìù –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
- –ü–µ—Ä–≤—ã–π —à–∞–≥ (1) ‚Üí +10 XP
- –ù–æ–≤–∏—á–æ–∫ (10) ‚Üí +20 XP
- –ê–∫—Ç–∏–≤–Ω—ã–π (50) ‚Üí +50 XP
- –ú–∞—Å—Ç–µ—Ä —É—á—ë—Ç–∞ (100) ‚Üí +100 XP
- –õ–µ–≥–µ–Ω–¥–∞ (500) ‚Üí +500 XP

**üí∞ –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è:**
- –¶–µ–ª—å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ ‚Üí +15 XP
- –ú–µ—á—Ç–∞ —Å–±—ã–ª–∞—Å—å ‚Üí +100 XP
- –ü–µ—Ä–≤–∞—è 10K ‚Üí +50 XP
- –ú–∞—Å—Ç–µ—Ä –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π (100K) ‚Üí +300 XP

**üî• –°—Ç—Ä–∏–∫–∏:**
- –ù–µ–¥–µ–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (7 –¥–Ω–µ–π) ‚Üí +30 XP
- –ú–µ—Å—è—Ü –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (30 –¥–Ω–µ–π) ‚Üí +100 XP
- –ö–≤–∞—Ä—Ç–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (90 –¥–Ω–µ–π) ‚Üí +300 XP
- –ì–æ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (365 –¥–Ω–µ–π) ‚Üí +1000 XP

**üíº –ë—é–¥–∂–µ—Ç—ã:**
- –ü–µ—Ä–≤—ã–π –±—é–¥–∂–µ—Ç ‚Üí +15 XP
- –ú–∞—Å—Ç–µ—Ä –±—é–¥–∂–µ—Ç–æ–≤ (3 –º–µ—Å—è—Ü–∞) ‚Üí +100 XP

**‚≠ê –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ:**
- –†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞ (–¥–æ 8:00) ‚Üí +10 XP
- –ü–æ–ª—É–Ω–æ—á–Ω–∏–∫ (–ø–æ—Å–ª–µ 23:00) ‚Üí +10 XP
- –í—ã—Ö–æ–¥–Ω–æ–π –≤–æ–∏–Ω (10 –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ) ‚Üí +30 XP

### –£—Ä–æ–≤–Ω–∏

**–§–æ—Ä–º—É–ª–∞:**
```
level = floor(sqrt(xp / 100)) + 1
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- 0-99 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 1
- 100-399 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 2
- 400-899 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 3
- 1600-2499 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 5

### –¢–∏—Ä—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

| –¢–∏—Ä | –¶–≤–µ—Ç | XP |
|-----|------|-----|
| ü•â –ë—Ä–æ–Ω–∑–∞ | #cd7f32 | 10-30 |
| ü•à –°–µ—Ä–µ–±—Ä–æ | #c0c0c0 | 50-100 |
| ü•á –ó–æ–ª–æ—Ç–æ | #ffd700 | 100-300 |
| üíé –ü–ª–∞—Ç–∏–Ω–∞ | #e5e4e2 | 500-1000 |

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–¢—Ä–∏–≥–≥–µ—Ä—ã –ë–î:**
- `trigger_check_transaction_achievements` ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `trigger_check_budget_achievements` ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—é–¥–∂–µ—Ç–∞
- `trigger_check_plan_achievements` ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞–Ω–∞
- `trigger_check_goal_achieved` ‚Äî –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞
- `trigger_update_transaction_streak` ‚Äî —Å—Ç—Ä–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ë–æ–Ω—É—Å—ã:**
- +1 XP –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- +5 XP –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞/–ø–ª–∞–Ω–∞
- +2 XP –∑–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

---

## –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

**–†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–≤ –æ—á–µ—Ä–µ–¥—å)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤ –æ—á–µ—Ä–µ–¥—å)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ (–≤ –æ—á–µ—Ä–µ–¥—å)

**–¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:**
- ‚ùå AI —Ñ—É–Ω–∫—Ü–∏–∏
- ‚ùå –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚ùå –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ë–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    ‚Üì
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ IndexedDB
    ‚Üì
–ü–æ–∫–∞–∑–∞—Ç—å —Å –º–µ—Ç–∫–æ–π "üîÑ –û–∂–∏–¥–∞–µ—Ç"
```

**–ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:**
```
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
    ‚Üì
–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
    ‚Üì
‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞–∫–µ
```

### API

```typescript
import { offlineQueue } from "@/lib/offline/queue";
import { syncService } from "@/lib/offline/sync";

// –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
await offlineQueue.add({
  type: "create",
  entity: "transactions",
  data: { ... }
});

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
await syncService.sync();

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
const status = await syncService.getStatus();
// { isOnline: true, isSyncing: false, pendingCount: 3 }
```

### –•—Ä–∞–Ω–∏–ª–∏—â–µ

```
IndexedDB: finapp_offline
Object Store: pending_operations
```

---

## –í–∏–¥–∂–µ—Ç—ã –∏ –¥–∞—à–±–æ—Ä–¥

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∂–µ—Ç–æ–≤

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
GET /api/dashboard/widget-order

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
POST /api/dashboard/widget-order
{ order: ['budget', 'financial-trends', ...] }
```

### –°–∫—Ä—ã—Ç–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤

```typescript
import { toggleWidgetVisibility } from '@/lib/dashboard/preferences/client';

await toggleWidgetVisibility('net-worth');
```

---

## –û–Ω–±–æ—Ä–¥–∏–Ω–≥

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—É—Ä (TourGuide)**
- –ü–æ—à–∞–≥–æ–≤–∞—è —ç–∫—Å–∫—É—Ä—Å–∏—è –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ localStorage

**–°—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ç—É—Ä–∞–º–∏:**
- `/dashboard`
- `/transactions`
- `/budgets`
- `/reports`
- `/ai-chat`

**2. –ß–µ–∫-–ª–∏—Å—Ç "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏"**

| –®–∞–≥ | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|----------|
| üó∫Ô∏è | –ü—Ä–æ–π—Ç–∏ —Ç—É—Ä –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é |
| üí≥ | –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å—á—ë—Ç |
| üí∏ | –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é |
| üìÇ | –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é |
| üéØ | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç |
| ü§ñ | –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å AI —á–∞—Ç |

**–§—É–Ω–∫—Ü–∏–∏:**
- –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ö–ª–∏–∫ –ø–æ –ø—É–Ω–∫—Ç—É ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- Progress bar —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
- –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

### API

```typescript
GET /api/onboarding/progress
// { accounts: 2, transactions: 15, categories: 8, budgets: 3, ai_messages: 5 }
```

### LocalStorage

- `tour_{page}_completed` ‚Äî –∑–∞–≤–µ—Ä—à—ë–Ω –ª–∏ —Ç—É—Ä
- `show_tours` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ —Ç—É—Ä—ã
- `onboarding_checklist_hidden` ‚Äî —Å–∫—Ä—ã—Ç –ª–∏ —á–µ–∫-–ª–∏—Å—Ç

---

## –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

| –£—Ä–æ–≤–µ–Ω—å | –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|--------|--------|
| –ë–î | –ö–æ–ø–µ–π–∫–∏ (BIGINT) | 564525527 |
| API | –ö–æ–ø–µ–π–∫–∏ | 564525527 |
| UI | –†—É–±–ª–∏ | 5645255.27 |

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

**UI ‚Üí –ë–î (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ):**
```typescript
const payload = {
  amount: Math.round(data.amount * 100)  // —Ä—É–±–ª–∏ ‚Üí –∫–æ–ø–µ–π–∫–∏
};
```

**–ë–î ‚Üí UI (–∑–∞–≥—Ä—É–∑–∫–∞):**
```typescript
reset({
  amount: tender.amount / 100  // –∫–æ–ø–µ–π–∫–∏ ‚Üí —Ä—É–±–ª–∏
});
```

### –£—Ç–∏–ª–∏—Ç—ã

```typescript
// lib/utils/currency.ts
export const rublesToKopecks = (rubles: number): number => 
  Math.round(rubles * 100);

export const kopecksToRubles = (kopecks: number): number => 
  kopecks / 100;

export const formatCurrency = (kopecks: number): string => {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
  }).format(kopecksToRubles(kopecks));
};
```

---

## CRON-–∑–∞–¥–∞—á–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (vercel.json)

```json
{
  "crons": [
    {
      "path": "/api/cron/auto-payments",
      "schedule": "0 9 * * *"
    }
  ]
}
```

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `/api/cron/auto-payments` | –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ (–∫–∞—Ä—Ç—ã + –∫—Ä–µ–¥–∏—Ç—ã) |
| `/api/cron/credit-card-payments` | –¢–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã |
| `/api/cron/loan-payments` | –¢–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç—ã |

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```env
CRON_SECRET=your-secret-token
```

```bash
POST /api/cron/auto-payments
Authorization: Bearer YOUR_CRON_SECRET
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏

```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É
CREATE POLICY "Users can view own transactions"
ON transactions FOR SELECT
USING (user_id = auth.uid());

-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ user_id –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ
CREATE POLICY "Users can view categories"
ON categories FOR SELECT
USING (user_id = auth.uid() OR is_system = true);
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...

# –°–µ—Ä–≤–µ—Ä–Ω—ã–µ (–Ω–∏–∫–æ–≥–¥–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ!)
OPENAI_API_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...
CRON_SECRET=...
```

---

## Troubleshooting

### AI –Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENAI_API_KEY`
2. –°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ embeddings –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `next_payment_date` –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤—Ä—É—á–Ω—É—é:
   ```sql
   SELECT * FROM auto_create_credit_card_payments();
   ```

### –û—Ñ–ª–∞–π–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IndexedDB –≤ DevTools
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `navigator.onLine`

### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã:
   ```sql
   SELECT * FROM information_schema.triggers
   WHERE event_object_table = 'transactions';
   ```
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä—É—á–Ω—É—é:
   ```sql
   SELECT check_count_achievement('user-id', 'first_transaction', 1);
   ```

---

**–†–µ–∂–∏–º "–§–∏–Ω–∞–Ω—Å—ã" –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ª–∏—á–Ω—ã–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π.
