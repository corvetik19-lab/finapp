# üîß Troubleshooting: –ú–æ–¥—É–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞
```
Error loading employees: Error: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
```

### –ü—Ä–∏—á–∏–Ω–∞
RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –¥–ª—è API endpoints, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç service role.

### –†–µ—à–µ–Ω–∏–µ

#### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `auth.role() = 'service_role'` –≤–æ –≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏:

```sql
-- –ü—Ä–∏–º–µ—Ä –¥–ª—è SELECT
CREATE POLICY employees_select_policy ON employees
  FOR SELECT
  USING (
    auth.role() = 'service_role'  -- ‚úÖ –†–∞–∑—Ä–µ—à–∞–µ–º service role
    OR
    company_id IN (
      SELECT company_id FROM employees 
      WHERE user_id = auth.uid() 
      AND deleted_at IS NULL
    )
  );
```

#### 2. –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
```sql
INSERT INTO employees (company_id, full_name, email, role, status, position)
VALUES 
  ('74b4c286-ca75-4eb4-9353-4db3d177c939', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–∏—Å—Ç–µ–º—ã', 'admin@company.com', 'admin', 'active', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'),
  ('74b4c286-ca75-4eb4-9353-4db3d177c939', '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', 'ivan@company.com', 'manager', 'active', '–ú–µ–Ω–µ–¥–∂–µ—Ä'),
  ('74b4c286-ca75-4eb4-9353-4db3d177c939', '–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤', 'petr@company.com', 'tender_specialist', 'active', '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç');
```

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:
1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–∏—Å—Ç–µ–º—ã** (admin@company.com) - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. **–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤** (ivan@company.com) - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —Ç–µ–Ω–¥–µ—Ä–∞–º
3. **–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤** (petr@company.com) - –¢–µ–Ω–¥–µ—Ä–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏:
- ‚úÖ `employees` - SELECT, INSERT, UPDATE, DELETE
- ‚úÖ `employee_history` - SELECT, INSERT
- ‚úÖ `employee_skills` - SELECT, INSERT

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **Service Role**: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (–¥–ª—è API endpoints)
- **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –î–æ—Å—Ç—É–ø –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
- **–ê–¥–º–∏–Ω—ã/–ú–µ–Ω–µ–¥–∂–µ—Ä—ã**: –ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- **–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã**: –ú–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å service role**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

2. **–î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç**
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ employee_history
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª–∏ –∏ –∏—Ö –ø—Ä–∞–≤–∞
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RBAC (Role-Based Access Control)

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
```
http://localhost:3000/tenders/employees
```

### 2. –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- ‚úÖ –°–ø–∏—Å–æ–∫ –∏–∑ 3 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- ‚úÖ –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫
curl http://localhost:3000/api/employees?company_id=74b4c286-ca75-4eb4-9353-4db3d177c939

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ ID
curl http://localhost:3000/api/employees/bc97dab6-907f-48be-8bc2-87b279b355b8
```

## üêõ –î—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "company_id –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç–µ `company_id` –≤ –∑–∞–ø—Ä–æ—Å–µ

### –û—à–∏–±–∫–∞: "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ID —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ —É–¥–∞–ª–µ–Ω (deleted_at IS NULL)

### –û—à–∏–±–∫–∞: "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (full_name, email, role)

### –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `company_id` –≤ –∫–æ–¥–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ SQL

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

1. ‚úÖ `0103_create_employees_system` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
2. ‚úÖ `fix_employees_rls_for_service_role` - –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
3. ‚úÖ `update_employees_rls_policies` - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
4. ‚úÖ `update_employee_history_and_skills_rls` - –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ú–æ–¥—É–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ä–æ–ª–∏ –∏ —Å—Ç–∞—Ç—É—Å—É
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏
