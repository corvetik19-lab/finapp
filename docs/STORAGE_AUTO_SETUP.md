# ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Storage

**–î–∞—Ç–∞:** 2025-10-20  
**–í–µ—Ä—Å–∏—è:** 1.0

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è bucket –≤ Supabase Storage.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### **–®–∞–≥ 1: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

–í —Ñ–∞–π–ª–µ `.env.local` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

---

### **–®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç**

```bash
node scripts/setup-storage.js
```

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

### **1. –°–æ–∑–¥–∞—ë—Ç bucket "attachments"**

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Supabase Storage API  
‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–π bucket (public: false)  
‚úÖ –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞: 10 MB  

### **2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è**

‚ö†Ô∏è **Storage RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ API**

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç 4 –ø–æ–ª–∏—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é:

1. **Users can upload own files** (INSERT)
2. **Users can view own files** (SELECT)
3. **Users can update own files** (UPDATE)
4. **Users can delete own files** (DELETE)

### **3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É**

‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω  
‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ bucket  

---

## üñ•Ô∏è –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Storage...

üì¶ –ü—Ä–æ–µ–∫—Ç: gwqvolspdzhcutvzsdbo
üîó URL: https://gwqvolspdzhcutvzsdbo.supabase.co

1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ bucket "attachments"...
   ‚úÖ Bucket —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ

2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è Storage...
   ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: Storage –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ API
   üìù –°–æ–∑–¥–∞–π—Ç–µ –∏—Ö –≤—Ä—É—á–Ω—É—é –≤ Supabase Dashboard:

   1. Users can upload own files
      Operation: INSERT
      Definition: bucket_id = 'attachments' AND (storage.foldername(name))[1] = auth.uid()::text

   2. Users can view own files
      Operation: SELECT
      Definition: bucket_id = 'attachments' AND (storage.foldername(name))[1] = auth.uid()::text

   3. Users can update own files
      Operation: UPDATE
      Definition: bucket_id = 'attachments' AND (storage.foldername(name))[1] = auth.uid()::text

   4. Users can delete own files
      Operation: DELETE
      Definition: bucket_id = 'attachments' AND (storage.foldername(name))[1] = auth.uid()::text

   üîó –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/project/gwqvolspdzhcutvzsdbo/storage/buckets/attachments
   ‚Üí –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Policies"
   ‚Üí –ù–∞–∂–º–∏—Ç–µ "New policy" –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –≤—ã—à–µ

3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
   ‚úÖ Bucket –Ω–∞–π–¥–µ–Ω
   üìä –ü—É–±–ª–∏—á–Ω—ã–π: –ù–µ—Ç ‚úÖ
   üìè –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞: 10.0 MB

‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
   1. –°–æ–∑–¥–∞–π—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤—Ä—É—á–Ω—É—é (—Å–º. –≤—ã—à–µ)
   2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: npm run dev
   3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
```

---

## üîß –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –≤—Ä—É—á–Ω—É—é

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞:

### **1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –≤—ã–≤–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç–∞ –∏–ª–∏:
1. https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
3. Storage ‚Üí attachments ‚Üí Policies

### **2. –°–æ–∑–¥–∞–π—Ç–µ 4 –ø–æ–ª–∏—Ç–∏–∫–∏**

–î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏:

1. –ù–∞–∂–º–∏—Ç–µ **New policy**
2. –í—ã–±–µ—Ä–∏—Ç–µ **Custom policy**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Policy name:** (–∏–∑ –≤—ã–≤–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç–∞)
   - **Operation:** INSERT/SELECT/UPDATE/DELETE
   - **Target roles:** `authenticated`
   - **Policy definition:** (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ –≤—ã–≤–æ–¥–∞)
4. –ù–∞–∂–º–∏—Ç–µ **Save policy**

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–∏—Ç–∏–∫:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev

# –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
http://localhost:3000/test-upload
```

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª:
- ‚úÖ –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª"
- ‚úÖ –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
- ‚úÖ –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### **–û—à–∏–±–∫–∞: "–ù–µ –Ω–∞–π–¥–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"**

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ Supabase Dashboard

### **–û—à–∏–±–∫–∞: "Bucket already exists"**

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, bucket —É–∂–µ —Å–æ–∑–¥–∞–Ω
- –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏

### **–û—à–∏–±–∫–∞: "Access denied" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ**

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–æ–∑–¥–∞–Ω—ã –≤—Å–µ 4 –ø–æ–ª–∏—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ bucket –ø—Ä–∏–≤–∞—Ç–Ω—ã–π (public: false)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

## üìö –°–º. —Ç–∞–∫–∂–µ

- `docs/STORAGE_SETUP.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `scripts/setup-storage.js` - –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞
- `components/attachments/FileUploader.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-10-20  
**–í–µ—Ä—Å–∏—è:** 1.0
